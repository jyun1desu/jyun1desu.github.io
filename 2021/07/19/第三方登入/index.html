<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>æ‰‹å‹•å»ºç«‹ Google ã€ Facebook ç¬¬ä¸‰æ–¹ç™»å…¥ - jyun1</title><link rel="manifest" href="/jyun1blog/manifest.json"><meta name="application-name" content="jyun1"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="jyun1"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="å‰é™£å­é‡åˆ°å®¢æˆ¶åæ‡‰ Facebookã€Google ç¬¬ä¸‰æ–¹ç™»å…¥ API åœ¨  instagram ã€ Line ç­‰å…§å»ºç€è¦½å™¨(in-app browser) ç„¡ç—•ç€è¦½æ¨¡å¼  ç„¡æ³•ä½¿ç”¨çš„å•é¡Œï¼ŒèŠ±äº†ä¸€æ®µæ™‚é–“ç³¾çµè·Ÿè§£æ±ºQQã€‚æ„å¤–å­¸äº†å¾ˆå¤šä»¥å‰ä¸çŸ¥é“çš„æ±è¥¿ï¼Œè¨˜éŒ„ä¸€ä¸‹ï¼"><meta property="og:type" content="blog"><meta property="og:title" content="æ‰‹å‹•å»ºç«‹ Google ã€ Facebook ç¬¬ä¸‰æ–¹ç™»å…¥"><meta property="og:url" content="https://jyun1desu.github.io/jyun1blog/2021/07/19/%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%85%A5/"><meta property="og:site_name" content="jyun1"><meta property="og:description" content="å‰é™£å­é‡åˆ°å®¢æˆ¶åæ‡‰ Facebookã€Google ç¬¬ä¸‰æ–¹ç™»å…¥ API åœ¨  instagram ã€ Line ç­‰å…§å»ºç€è¦½å™¨(in-app browser) ç„¡ç—•ç€è¦½æ¨¡å¼  ç„¡æ³•ä½¿ç”¨çš„å•é¡Œï¼ŒèŠ±äº†ä¸€æ®µæ™‚é–“ç³¾çµè·Ÿè§£æ±ºQQã€‚æ„å¤–å­¸äº†å¾ˆå¤šä»¥å‰ä¸çŸ¥é“çš„æ±è¥¿ï¼Œè¨˜éŒ„ä¸€ä¸‹ï¼"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://jyun1desu.github.io/jyun1blog/img/covers/js.jpg"><meta property="article:published_time" content="2021-07-19T12:44:05.000Z"><meta property="article:modified_time" content="2021-07-19T13:57:27.963Z"><meta property="article:author" content="jyun1"><meta property="article:tag" content="ç¬¬ä¸‰æ–¹ç™»å…¥"><meta property="article:tag" content="googleç™»å…¥"><meta property="article:tag" content="facebookç™»å…¥"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/jyun1blog/img/covers/js.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://jyun1desu.github.io/jyun1blog/2021/07/19/%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%85%A5/"},"headline":"æ‰‹å‹•å»ºç«‹ Google ã€ Facebook ç¬¬ä¸‰æ–¹ç™»å…¥","image":["https://jyun1desu.github.io/jyun1blog/img/covers/js.jpg"],"datePublished":"2021-07-19T12:44:05.000Z","dateModified":"2021-07-19T13:57:27.963Z","author":{"@type":"Person","name":"jyun1"},"publisher":{"@type":"Organization","name":"jyun1","logo":{"@type":"ImageObject","url":null}},"description":"å‰é™£å­é‡åˆ°å®¢æˆ¶åæ‡‰ Facebookã€Google ç¬¬ä¸‰æ–¹ç™»å…¥ API åœ¨  instagram ã€ Line ç­‰å…§å»ºç€è¦½å™¨(in-app browser) ç„¡ç—•ç€è¦½æ¨¡å¼  ç„¡æ³•ä½¿ç”¨çš„å•é¡Œï¼ŒèŠ±äº†ä¸€æ®µæ™‚é–“ç³¾çµè·Ÿè§£æ±ºQQã€‚æ„å¤–å­¸äº†å¾ˆå¤šä»¥å‰ä¸çŸ¥é“çš„æ±è¥¿ï¼Œè¨˜éŒ„ä¸€ä¸‹ï¼"}</script><link rel="canonical" href="https://jyun1desu.github.io/jyun1blog/2021/07/19/%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%85%A5/"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/jyun1blog/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/jyun1blog/">jyun1</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/jyun1blog/">Home</a><a class="navbar-item" href="/jyun1blog/archives">Archives</a><a class="navbar-item" href="/jyun1blog/categories">Categories</a><a class="navbar-item" href="/jyun1blog/tags">Tags</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/jyun1blog/img/covers/js.jpg" alt="æ‰‹å‹•å»ºç«‹ Google ã€ Facebook ç¬¬ä¸‰æ–¹ç™»å…¥"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-07-19T12:44:05.000Z" title="2021-7-19 8:44:05 â”œF10: PMâ”¤">2021-07-19</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-07-19T13:57:27.963Z" title="2021-7-19 9:57:27 â”œF10: PMâ”¤">2021-07-19</time></span><span class="level-item"><a class="link-muted" href="/jyun1blog/categories/JavaScript/">JavaScript</a></span><span class="level-item">12 minutes read (About 1753 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">æ‰‹å‹•å»ºç«‹ Google ã€ Facebook ç¬¬ä¸‰æ–¹ç™»å…¥</h1><div class="content"><p>å‰é™£å­é‡åˆ°å®¢æˆ¶åæ‡‰ Facebookã€Google ç¬¬ä¸‰æ–¹ç™»å…¥ API åœ¨</p>
<ul>
<li>instagram ã€ Line ç­‰å…§å»ºç€è¦½å™¨(in-app browser)</li>
<li>ç„¡ç—•ç€è¦½æ¨¡å¼</li>
</ul>
<p>ç„¡æ³•ä½¿ç”¨çš„å•é¡Œï¼ŒèŠ±äº†ä¸€æ®µæ™‚é–“ç³¾çµè·Ÿè§£æ±ºQQã€‚æ„å¤–å­¸äº†å¾ˆå¤šä»¥å‰ä¸çŸ¥é“çš„æ±è¥¿ï¼Œè¨˜éŒ„ä¸€ä¸‹ï¼</p>
<span id="more"></span>
<h2 id="åŸå…ˆçš„åšæ³•"><a href="#åŸå…ˆçš„åšæ³•" class="headerlink" title="åŸå…ˆçš„åšæ³•"></a>åŸå…ˆçš„åšæ³•</h2><p>åˆ©ç”¨ Facebookã€Google æä¾›çš„ API ï¼Œä½¿ç”¨èµ·ä¾†å¾ˆå–®ç´”ï¼šé–‹å•Ÿæ–°åˆ†é ï¼Œä½¿ç”¨è€…å®Œæˆç™»å…¥æµç¨‹å¾Œå›å‚³è³‡æ–™çµ¦åŸå…ˆçš„é é¢ä¸¦è‡ªå‹•é—œé–‰ã€‚</p>
<h3 id="ğŸ¤¯-in-app-browser-çš„å•é¡Œï¼š-é–‹å•Ÿæ–°åˆ†é "><a href="#ğŸ¤¯-in-app-browser-çš„å•é¡Œï¼š-é–‹å•Ÿæ–°åˆ†é " class="headerlink" title="ğŸ¤¯  in-app browser çš„å•é¡Œï¼š é–‹å•Ÿæ–°åˆ†é "></a>ğŸ¤¯  in-app browser çš„å•é¡Œï¼š é–‹å•Ÿæ–°åˆ†é </h3><p>é€™é¡ç€è¦½å™¨å¤§å¤š <strong>æ²’æœ‰åˆ†é åŠŸèƒ½ï¼Œæœƒç›´æ¥åœ¨åŒä¸€é åšåˆ‡æ›</strong>ã€‚åŸå…ˆç­‰å¾…å›å‚³çš„é‚£é å°±æ¶ˆå¤±äº†ï¼Œä¹Ÿå°±ç„¡æ³•æ”¶åˆ°å›å‚³ã€‚</p>
<h3 id="ğŸ¤¯-ç„¡ç—•ç€è¦½çš„å•é¡Œï¼š-cookie-è¢«é˜»æ“‹"><a href="#ğŸ¤¯-ç„¡ç—•ç€è¦½çš„å•é¡Œï¼š-cookie-è¢«é˜»æ“‹" class="headerlink" title="ğŸ¤¯ ç„¡ç—•ç€è¦½çš„å•é¡Œï¼š cookie è¢«é˜»æ“‹"></a>ğŸ¤¯ ç„¡ç—•ç€è¦½çš„å•é¡Œï¼š cookie è¢«é˜»æ“‹</h3><p>Safari å’Œ Chrome çš„è¡¨ç¾ä¸å¤ªä¸€æ¨£ã€‚Safari ï¼ˆ14.0.3ï¼‰æ²’å•é¡Œï¼Œä½† <a target="_blank" rel="noopener" href="https://developers.google.com/identity/sign-in/web/troubleshooting#third-party_cookies_and_data_blocked">Chrome æœƒæ“‹ cookie é€²è€Œå½±éŸ¿åˆ°è‡ªå®¶çš„ç™»å…¥API</a> (å‚»çœ¼)</p>
<p><img src="https://i.imgur.com/n2duZGn.jpg"><br>chrome ç„¡ç—•æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨ <code>gapi.auth2.init</code> æ–¹æ³•æœƒå‡ºç¾çš„error messageã€‚</p>
<h2 id="æ‰‹å‹•å»ºç«‹ç™»å…¥æµç¨‹ï¼šone-page-flow"><a href="#æ‰‹å‹•å»ºç«‹ç™»å…¥æµç¨‹ï¼šone-page-flow" class="headerlink" title="æ‰‹å‹•å»ºç«‹ç™»å…¥æµç¨‹ï¼šone-page-flow"></a>æ‰‹å‹•å»ºç«‹ç™»å…¥æµç¨‹ï¼šone-page-flow</h2><p>ä¸»è¦æ˜¯åœ¨åŒä¸€é é¢åˆ©ç”¨è½‰å€çš„æ–¹å¼é€²è¡Œç™»å…¥ï¼Œä¸¦åœ¨æœ€å¾Œå°‡ç™»å…¥è³‡æ–™å¸¶åœ¨è½‰å›ç¶²å€çš„åƒæ•¸ä¸­ã€‚å¾</p>
<ul>
<li>åŸå…ˆï¼šæŒ‰ä¸‹ç™»å…¥ â†’ é–‹å•Ÿæ–°åˆ†é  â†’ ç™»å…¥ â†’ é—œé–‰åˆ†é  â†’ åŸå…ˆç™»å…¥é æ¥æ”¶ API å›å‚³</li>
<li>æ”¹æˆï¼šæŒ‰ä¸‹ç™»å…¥ â†’ å‰å¾€ç™»å…¥é  â†’ ç™»å…¥ â†’ å°å›æŒ‡å®šé é¢ï¼Œè³‡æ–™å¸¶åœ¨ç¶²å€ä¸­ </li>
</ul>
<p>åªè¦è¨­å®šå¥½ <strong>ç™»å…¥é çš„ç¶²å€</strong> å°±å·®ä¸å¤šæˆåŠŸäº†ï¼›å°å›å¾Œï¼Œä¹Ÿåªè¦åœ¨ route ä¸­å»å¢åŠ ä¸€äº›å°åƒæ•¸çš„åˆ¤æ–·ã€è™•ç†å°±å¥½äº†ã€‚</p>
<h3 id="Facebook"><a href="#Facebook" class="headerlink" title="Facebook"></a>Facebook</h3><p>è¦ºå¾—<a target="_blank" rel="noopener" href="https://developers.facebook.com/docs/facebook-login/manually-build-a-login-flow">è‡‰æ›¸å¯«çš„æ–‡ä»¶</a>æ¯”è¼ƒå¥½æ‡‚ï¼Œå…ˆæ‹¿è‡‰æ›¸ä¾†ç•¶ç¯„ä¾‹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//www.facebook.com/v10.0/dialog/oauth?</span></span><br><span class="line">    client_id=&#123;app-id&#125; <span class="comment">//required</span></span><br><span class="line">    &amp;redirect_uri=&#123;ç™»å…¥å®Œå¾Œçš„å›å‚³å€&#125; <span class="comment">//required</span></span><br><span class="line">    &amp;state=&#123;é˜²æ­¢è·¨ç¶²ç«™å½é€ çš„çš„å­—ä¸²ï¼Œä¹Ÿæœƒè¢«æ”¾åœ¨å›å‚³ç¶²å€ä¸­&#125; <span class="comment">//required</span></span><br><span class="line">    &amp;response_type=&#123;å›å‚³è³‡æ–™é¡å‹&#125; <span class="comment">//optionalï¼Œé è¨­ç‚º code</span></span><br><span class="line">    &amp;scope=&#123;ä½ è¦å‘ä½¿ç”¨è€…è¦æ±‚çš„å¸³è™Ÿæ¬Šé™&#125; <span class="comment">//optional</span></span><br></pre></td></tr></table></figure>

<h3 id="Google"><a href="#Google" class="headerlink" title="Google"></a>Google</h3><p>é™¤äº†å¯ä»¥çœ‹ <a target="_blank" rel="noopener" href="https://developers.google.com/identity/protocols/oauth2/javascript-implicit-flow#oauth-2.0-endpoints">JS Web Apps</a> ï¼Œä¹Ÿå¯ä»¥ä¸€èµ·çœ‹ <a target="_blank" rel="noopener" href="https://developers.google.com/identity/protocols/oauth2/native-app">Mobile and Desktop Apps</a> è£¡çš„å…§å®¹ï¼Œå¯«èµ·ä¾†è·Ÿ facebook å¹¾ä¹å®Œå…¨ä¸€æ¨£ XDï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//accounts.google.com/o/oauth2/v2/auth?</span></span><br><span class="line">    client_id=&#123;app-id&#125;</span><br><span class="line">    &amp;redirect_uri=https:<span class="comment">//jyun1desu.com/login</span></span><br><span class="line">    &amp;state=google</span><br><span class="line">    &amp;response_type=code</span><br><span class="line">    &amp;scope=email%20profile</span><br></pre></td></tr></table></figure>

<h3 id="æ¯”è¼ƒéœ€è¦æ³¨æ„çš„åƒæ•¸ï¼š"><a href="#æ¯”è¼ƒéœ€è¦æ³¨æ„çš„åƒæ•¸ï¼š" class="headerlink" title="æ¯”è¼ƒéœ€è¦æ³¨æ„çš„åƒæ•¸ï¼š"></a>æ¯”è¼ƒéœ€è¦æ³¨æ„çš„åƒæ•¸ï¼š</h3><ul>
<li><p><strong>response_type</strong></p>
<ul>
<li><code>code</code>ï¼š è·Ÿ API ç›´æ¥å–å¾— <code>access_token</code> ä¸åŒï¼Œéœ€è¦èµ° server-side loginï¼šå‰ç«¯çµ¦å¾Œç«¯ <code>code</code> ï¼Œç”±å¾Œç«¯å»æ›å– <code>access_token</code>ã€‚</li>
<li><code>token</code>ï¼š ç›´æ¥å–å¾— <code>access_token</code>ã€‚</li>
</ul>
<p>  é›–ç„¶ç›´æ¥è¨­å®š <code>token</code> å¾ˆæ–¹ä¾¿ï¼Œä½†è³‡æ–™ä¸æœƒä»¥åƒæ•¸(?)ã€è€Œæ˜¯ä»¥ç¶²å€ç‰‡æ®µ(#)çš„æ–¹å¼å­˜åœ¨ã€‚è¦ºå¾—é€™æ¨£å–è³‡æ–™æœ‰é»éº»ç…©ã€ä¹Ÿæœ‰å·¥ç¨‹å¸«å»ºè­° server-side login å¾Œç«¯çš„æ¬Šé™ç®¡ç†æœƒæ¯”è¼ƒè¸å¯¦ï¼Œå°±æ±ºå®šå– <code>code</code> äº†ï¼ˆå¾Œç«¯äººå¾ˆå¥½ï¼‰ã€‚</p>
</li>
<li><p><strong>redirect_uri</strong><br>  è¦è¨˜å¾—åˆ°ç•¶åˆåœ¨ facebook developer / google cloud å»ºç«‹çš„æ‡‰ç”¨ç¨‹å¼ä¸­ï¼Œ <strong>æœ‰æ•ˆçš„ OAuth é‡æ–°å°å‘ URI</strong> æ–°å¢æœ‰æ•ˆç¶²å€ã€‚ä¸åœ¨åˆ—è¡¨ä¸­çš„ç¶²å€éƒ½æœƒè¢«æ“‹ä¸‹ä¾†(è·¯å¾‘ã€åƒæ•¸ä¹Ÿéƒ½è¦å¡«ä¸Š)ã€‚</p>
</li>
</ul>
<h2 id="å¯æ˜¯æˆ‘æƒ³é–‹å•Ÿæ–°é é¢-R"><a href="#å¯æ˜¯æˆ‘æƒ³é–‹å•Ÿæ–°é é¢-R" class="headerlink" title="å¯æ˜¯æˆ‘æƒ³é–‹å•Ÿæ–°é é¢ R"></a>å¯æ˜¯æˆ‘æƒ³é–‹å•Ÿæ–°é é¢ R</h2><p>æ’‡é™¤åœ¨ in-app browser æ²’æœ‰åˆ†é åŠŸèƒ½å…ˆä¸ç†å®ƒXDï¼Œé€™å€‹æ–¹æ³•æœ€å¤§çš„ç¼ºé»æ˜¯é é¢éƒ½æœƒåœ¨åŒä¸€é è·³è½‰ï¼Œè·Ÿå¤šæ•¸ä½¿ç”¨è€…ç¿’æ…£çš„é«”é©—æ˜¯ä¸ä¸€æ¨£çš„ã€‚ä¸€é–‹å§‹æƒ³æ³•æ˜¯ï¼š</p>
<ul>
<li>in-app browser â†’ æ‰‹å‹•æµç¨‹(ä¸é–‹æ–°åˆ†é )</li>
<li>ä¸€èˆ¬ç€è¦½å™¨ <ul>
<li>æ­£å¸¸æ¨¡å¼ â†’ ä¿ç•™ä½¿ç”¨API</li>
<li>ç„¡ç—•æ¨¡å¼ â†’ æ‰‹å‹•æµç¨‹(ä¸é–‹æ–°åˆ†é )</li>
</ul>
</li>
</ul>
<p>çµæœæ‰¾ä¸åˆ°åˆ¤æ–·ç„¡ç—•çš„å¯é æ–¹æ³•â€¦ğŸ¥² ï¼Œåªèƒ½æ”¹æˆé€™æ¨£ï¼š</p>
<ul>
<li>in-app browser â†’ æ‰‹å‹•æµç¨‹(ä¸é–‹æ–°åˆ†é )</li>
<li>ä¸€èˆ¬ç€è¦½å™¨ â†’ æ‰‹å‹•æµç¨‹(ä¸é–‹æ–°åˆ†é â‹¯â‹¯ä½†å¥½æƒ³é–‹Rï¼ï¼ï¼)</li>
</ul>
<p>æ–¼æ˜¯é–‹å§‹æƒ³è¦æ€éº¼æ¨¡æ“¬ API <strong>é–‹å•Ÿæ–°åˆ†é </strong>ã€<strong>å‚³è³‡æ–™çµ¦éš”å£åˆ†é </strong>ã€<strong>è‡ªå‹•é—œé–‰</strong> çš„è¡Œç‚ºï¼š</p>
<ul>
<li>é–‹å•Ÿæ–°åˆ†é ï¼šç”¨ <code>window.open()</code> å³å¯ XD </li>
<li>è‡ªå‹•é—œé–‰ï¼šé€™å€‹ä¹Ÿå¾ˆç°¡å–®ï¼Œç”¨ <code>window.close()</code> å³å¯ XD</li>
<li>å‚³è³‡æ–™çµ¦éš”å£åˆ†é ï¼šé€™å€‹å¥½é›£RRRRRRRï¼ï¼ï¼ï¼ï¼</li>
</ul>
<p>ç³¾çµå¥½å¹¾å¤©å¾Œï¼ˆé€£ <code>localStorage</code> æ­é… <code>visibilitychangeEvent</code> éƒ½è©¦äº†ğŸ¥²ï¼‰ï¼Œç™¼ç¾å¾ˆè®šçš„</p>
<h2 id="window-postMessage"><a href="#window-postMessage" class="headerlink" title="window.postMessage()"></a>window.postMessage()</h2><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage">MDNçš„è§£é‡‹å¾ˆè©³ç´°</a> ï¼Œä»¥å‰å±…ç„¶ä¸çŸ¥é“é€™å€‹ APIï¼Œæœ¬æ¬¡æœ€å¤§æ”¶ç©«ï½ï½ï½</p>
<p><code>postMessage</code> å¯ä»¥å¯¦ç¾åŒå€‹ç€è¦½å™¨ä¸‹çš„æºé€šï¼štabé–“ã€å½ˆå‡ºè¦–çª—èˆ‡ä¸»è¦–çª—é–“ã€ç”šè‡³å’ŒåµŒå…¥çš„ <code>iframe</code> ä¹Ÿå¯ä»¥ï½å¤ªæ–¹ä¾¿å•¦ï¼ä½¿ç”¨èµ·ä¾†ä¹Ÿæ»¿ç›´è§€çš„ï¼š</p>
<p><code>postMessage(message, targetOrigin, transfer)</code> </p>
<ul>
<li>messageï¼šè¦å‚³é€çš„è³‡æ–™ï¼Œå¿…å¡«ã€‚</li>
<li>targetOriginï¼šé™åˆ¶æ¥æ”¶å°è±¡çš„ origin ï¼Œä½¿ç”¨å­—ä¸² * å‰‡ä»£è¡¨ç„¡é™åˆ¶ï¼Œå¿…å¡«ã€‚</li>
<li>transferï¼šçœ‹ç„¡â€¦.ä½†å¥½åƒä¸å¤ªç”¨åˆ°ã€‚</li>
</ul>
<p>ç›£è½ä¾†è‡ªä»–æ–¹çš„ <code>message</code> ä¹Ÿå¾ˆç°¡å–®ï¼š<br><code>window.addEventListener(&#39;message&#39;, callback)</code></p>
<h2 id="ç°¡æ˜“çš„ç¯„ä¾‹"><a href="#ç°¡æ˜“çš„ç¯„ä¾‹" class="headerlink" title="ç°¡æ˜“çš„ç¯„ä¾‹"></a>ç°¡æ˜“çš„ç¯„ä¾‹</h2><p>åœ¨æŒ‰ä¸‹ç¬¬ä¸‰æ–¹ç™»å…¥éˆ•çš„æ™‚å€™åˆ¤æ–·æ˜¯å¦æ˜¯ in-app browser</p>
<ul>
<li>trueï¼š ä¸é–‹å•Ÿæ–°é é¢</li>
<li>falseï¼š é–‹å•Ÿæ–°é é¢ã€ redirect_uri å¤šè¨­å®šä¸€å€‹åƒæ•¸ï¼Œåˆ¤æ–·å›ä¾†è¦åšä¸€äº›äº‹</li>
</ul>
<hr>
<p>é»æ“Šç¬¬ä¸‰æ–¹ç™»å…¥éˆ•è§¸ç™¼ <code>openThirdPartyAuthPage</code>ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> addReciveMessageListener = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> reciveEvent = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> data = e.data</span><br><span class="line">        <span class="keyword">if</span>(origin === <span class="built_in">window</span>.location.origin &amp;&amp; data.code) &#123;</span><br><span class="line">            doSomethingToLogin(data.code)</span><br><span class="line">            <span class="built_in">window</span>.removeEventListener(<span class="string">&#x27;message&#x27;</span>, reciveEvent, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">&#x27;message&#x27;</span>, reciveEvent, <span class="literal">false</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getOAuthPageURL = <span class="function">(<span class="params">platform, isWebview</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">const</span> redirect = isWebview? <span class="string">&#x27;.../login&#x27;</span> : <span class="string">&#x27;.../login?type=auto-close&#x27;</span>;</span><br><span class="line">	<span class="keyword">switch</span>(platform) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;facebook&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">`https:// .....&amp;redirect_uri=<span class="subst">$&#123;redirectUri&#125;</span>....`</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;google&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">`https:// .....&amp;redirect_uri=<span class="subst">$&#123;redirectUri&#125;</span>....`</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> toThirdPartyOAuthPage = <span class="function"><span class="params">platform</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">const</span> isWebview = ...; <span class="comment">//åšä¸€äº› in-app browser çš„åˆ¤æ–·</span></span><br><span class="line">	<span class="keyword">const</span> authPageURL = getOAuthPageURL(platform, isWebview);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(isWebview)&#123;</span><br><span class="line">            <span class="built_in">window</span>.location.href = authPageURL;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            addReciveMessageListener();</span><br><span class="line">            <span class="built_in">window</span>.open(authPageURL);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¦–çª—å›åˆ° <code>redirect_uri</code> å¾Œï¼Œåœ¨ route ä¸­è™•ç†ç™»å…¥è¡Œç‚ºï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes/Login/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; code, type, ... &#125; = ç¶²å€çš„query;</span><br><span class="line"><span class="keyword">const</span> sendDataToLoginPage = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> loginData = &#123; code &#125;;</span><br><span class="line">    <span class="built_in">window</span>.opener.postMessage(loginData, <span class="string">&#x27;http://jyun1desu.com&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(code) &#123;</span><br><span class="line">    <span class="keyword">if</span>(type === <span class="string">&#x27;auto-close&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// normal browser redirect page</span></span><br><span class="line">            sendDataToLoginPage();</span><br><span class="line">            <span class="built_in">window</span>.close();</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// in-app browser redirect page</span></span><br><span class="line">            doSomethingToLogin(code)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸçš„æ™‚å€™å¥½æ„Ÿå‹•å•Šï½ï½ï½ ğŸ‰ğŸ‰ğŸ‰</p>
<p>æ‰¾è³‡æ–™çš„éç¨‹ä¸­ä¹Ÿæœ‰çœ‹åˆ° <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API">Broadcast Channel API</a> ï¼Œé›–ç„¶æ”¯æ´åº¦é‚„å¾ˆæ‚²åŠ‡ï¼Œæ„Ÿè¦ºæ˜¯èƒ½å…ˆçœ‹èµ·ä¾†çš„æ±è¥¿ã€‚æœ€å¾Œè¬è¬ hahow ï¼Œ ä¸€åº¦è¦ºå¾—è§£æ±ºä¸äº†çš„ç„¡å¾ˆå¤šå•é¡Œï¼Œå»çœ‹äº† hahow çš„ç¶²ç«™ä¹‹å¾Œæ‰ç™¼ç¾ï¼šå—¯ï¼æœç„¶æ˜¯è‡ªå·±å¤ªæ·ºã„Œ&gt;&lt;ï¼Œå°±æ˜¯æœ‰äººåšå¾—åˆ°å•Šï¼ï¼ï¼è€Œä¸”å¯«é€™ç¯‡æ–‡ç« çš„æ™‚å€™ï¼Œçªç„¶è¦ºå¾—æ˜¯ä¸æ˜¯å…¶å¯¦æ»¿ç°¡å–®çš„â‹¯â‹¯ï¼ˆä½†ç¬¬ä¸€æ¬¡ç¢°åˆ°å°±æ˜¯è¦ºå¾—å¾ˆé›£QQï¼‰ã€‚</p>
<p>ä»¥ä¸Šï¼å¸Œæœ›èƒ½å¹«åŠ©åˆ°æ­£åœ¨å›°æ“¾åŒæ¨£å•é¡Œçš„äºº ğŸ‰</p>
<h2 id="åƒè€ƒè³‡æ–™"><a href="#åƒè€ƒè³‡æ–™" class="headerlink" title="åƒè€ƒè³‡æ–™"></a>åƒè€ƒè³‡æ–™</h2><p><a target="_blank" rel="noopener" href="https://developers.google.com/identity/protocols/oauth2/javascript-implicit-flow">Google OAuth</a><br><a target="_blank" rel="noopener" href="https://developers.facebook.com/docs/facebook-login/web?locale=zh_TW">Facebook OAuth</a><br><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage">postMessage API</a></p>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/jyun1blog/tags/%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%85%A5/">ç¬¬ä¸‰æ–¹ç™»å…¥</a><a class="link-muted mr-2" rel="tag" href="/jyun1blog/tags/google%E7%99%BB%E5%85%A5/">googleç™»å…¥</a><a class="link-muted mr-2" rel="tag" href="/jyun1blog/tags/facebook%E7%99%BB%E5%85%A5/">facebookç™»å…¥</a></div><!--!--></article></div><!--!--><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://jyun1desu.github.io/jyun1blog/2021/07/19/%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%85%A5/';
            this.page.identifier = '2021/07/19/ç¬¬ä¸‰æ–¹ç™»å…¥/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + '[object Object]' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/jyun1blog/img/avatar.jpg" alt="jyun1desu"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">jyun1desu</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Taipei</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Post</p><a href="/jyun1blog/archives"><p class="title">1</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Category</p><a href="/jyun1blog/categories"><p class="title">1</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/jyun1blog/tags"><p class="title">3</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/jyun1desu" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/jyun1desu"><i class="fab fa-github"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/jyun1blog/categories/JavaScript/"><span class="level-start"><span class="level-item">JavaScript</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-19T12:44:05.000Z">2021-07-19</time></p><p class="title"><a href="/jyun1blog/2021/07/19/%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%85%A5/">æ‰‹å‹•å»ºç«‹ Google ã€ Facebook ç¬¬ä¸‰æ–¹ç™»å…¥</a></p><p class="categories"><a href="/jyun1blog/categories/JavaScript/">JavaScript</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/jyun1blog/archives/2021/07/"><span class="level-start"><span class="level-item">July 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/jyun1blog/tags/facebook%E7%99%BB%E5%85%A5/"><span class="tag">facebookç™»å…¥</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/jyun1blog/tags/google%E7%99%BB%E5%85%A5/"><span class="tag">googleç™»å…¥</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/jyun1blog/tags/%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%85%A5/"><span class="tag">ç¬¬ä¸‰æ–¹ç™»å…¥</span><span class="tag">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/jyun1blog/">jyun1</a><p class="is-size-7"><span>&copy; 2021 jyun1</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'folded'
                }
            }
        };</script><script src="/jyun1blog/js/column.js"></script><script src="/jyun1blog/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/jyun1blog/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/jyun1blog/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/jyun1blog/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/jyun1blog/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>