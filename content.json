{"pages":[],"posts":[{"title":"aspect-ratioï¼šç­‰æ¯”ä¾‹ç¸®æ”¾å€å¡Šçš„å±¬æ€§ä¾†äº†ï¼","text":"é–‹ç™¼çš„æ™‚å€™å¸¸å¸¸é‡åˆ°éœ€è¦å›ºå®šå€å¡Šæ¯”ä¾‹çš„æƒ…å¢ƒï¼Œè€Œä¸”é€šå¸¸é•·å¯¬éƒ½ä¸æ˜¯çµ•å°çš„æ•¸å€¼ã€‚ä¹‹å‰éƒ½æ˜¯åˆ©ç”¨ padding çš„ç‰¹æ€§å»åšç­‰æ¯”ä¾‹å€å¡Šã€‚ä½†ç¾åœ¨æœ‰äº†æ›´æ–¹ä¾¿çš„ aspect-ratioï¼ŒåŠ ä¸Š vw/vh ï¼Œæ•´ç†äº† 3 å€‹å¯ä»¥ä½¿ç”¨çš„æ–¹æ³•ï¼š 1. vw or vhvwã€vhåˆ†åˆ¥æŒ‡ç€è¦½å™¨çš„å¯¬åº¦ä»¥åŠé«˜åº¦ï¼Œé€™å€‹æ–¹æ³•åœ¨ä½ˆå±€æ¯”è¼ƒç°¡å–®çš„è¡Œå‹•ç‰ˆè£ç½®ä¸Šæ¯”è¼ƒå¯è¡Œã€‚ä»¥ä¸‹æ˜¯ä¸€å€‹é•·å¯¬éƒ½æ˜¯50%è¢å¹•å¯¬åº¦çš„æ­£æ–¹å½¢ï¼š 1234.square-box { width: 50vw; height: 50vw;} 2. padding + positionpadding æœ‰å€‹ç‰¹æ€§â€”â€”çµ¦äºˆçš„å€¼æ˜¯ç™¾åˆ†æ¯”æ™‚ï¼Œç™¾åˆ†æ¯”çš„æ•¸å€¼æ˜¯åŸºæ–¼çˆ¶å±¤å…ƒç´ çš„å¯¬åº¦ã€è€Œä¸æ˜¯å…ƒç´ æœ¬èº«ã€‚å‡è¨­ç¾åœ¨éœ€è¦ä¸€å€‹ 16:9 çš„å€å¡Šï¼Œå¯ä»¥é€™æ¨£åšï¼šé€éwidth: 100% ï¼šå–å¾— .parent å¯¬åº¦çš„ 100%;padding-bottom: 56.25% ï¼šå–å¾— .parent å¯¬åº¦çš„ 56.25%;è£½ä½œå‡º 16:9 ç­‰æ¯”ä¾‹ç¸®æ”¾çš„å¤–å±¤ .outer å¾Œï¼Œå†çµ•å°å®šä½å…§å±¤ .content ï¼Œä¸¦å°‡å¯¬é«˜çš†è¨­ç½®æˆ 100%ï¼Œå°±èƒ½å¾—åˆ°ä¸€å€‹èˆ‡å¤–å±¤ç›¸åŒå¤§å°ï¼Œä½†å¯ä»¥ä»»æ„ä½ˆå±€å…§éƒ¨å…ƒç´ çš„å€å¡Šäº†ï¼ See the Pen aspect-radio by jyun1 (@jyun1desu) on CodePen. æ‡¶å¾—è¨ˆç®—çš„è©±ï¼Œä¹Ÿå¯ä»¥ç”¨ calc()ï¼š 1234.child { width: 100%; padding-bottom: calc(9/16 * 100%);} 3. ç°¡å–®æš´åŠ›çš„ aspect-ratioaspect-ratio æ˜¯æ»¿æ–°çš„ CSS å±¬æ€§ï¼Œæ”¯æ´åº¦å¯ä»¥çœ‹é€™è£¡ã€‚åªè¦ä½¿ç”¨ aspect-ratio: ratio;ï¼Œ ratio çš„è¡¨ç¾æ–¹å¼æ˜¯width/heightï¼ˆæœ‰å¤ ç°¡å–®ï¼ï¼‰ã€‚ä¹Ÿèƒ½è¨­ç½®æœ€å¤§å¯¬åº¦ã€é«˜åº¦ï¼Œä¾ç„¶æœƒç¶­æŒç­‰æ¯”ä¾‹ï¼Œæ„Ÿè¦ºé€™é»æ˜¯æ–¹æ³•2åšä¸åˆ°çš„ã€‚ See the Pen aspect-radio by jyun1 (@jyun1desu) on CodePen. åƒè€ƒè³‡æ–™W3C Aspect Ratios","link":"/2021/08/01/aspect-ratio/"},{"title":"Recoil: Reactå®˜æ–¹æ¨å‡ºçš„ç‹€æ…‹ç®¡ç†å·¥å…·","text":"Recoil æ˜¯ Facebook åœ¨2020æ¨å‡ºçš„ç‹€æ…‹ç®¡ç† Libraryï¼Œé‚„åœ¨å¯¦é©—éšæ®µï¼ˆä¸æ¨è–¦ç”¨åœ¨å¤§å‹å°ˆæ¡ˆï¼‰ã€‚é›–ç„¶ä¸åƒ redux æœ‰å„ç¨®ç¥å¥‡çš„ç”¨æ³•ï¼Œä½†æ¯”èµ·ä¾†å°‘äº†å¾ˆå¤šå›ºå®šçš„èªæ³•è¦å¯«ï¼Œä½¿ç”¨èµ·ä¾†å¾ˆç°¡å–®ï¼ æ ¸å¿ƒæ¦‚å¿µä¸€åœ–ä»¥è”½ä¹‹çš„æ¦‚å¿µåœ–ï¼š Recoilä¸­æœ‰å…©ç¨® shared state ï¼Œéƒ½èƒ½å¤ è¢«è¨‚é–±ã€æ›´æ–°ï¼š atomï¼š æ˜¯ shared state çš„åŸºæœ¬å–®ä½ã€‚ selectorï¼š ç‚ºä¸€ pure function ï¼Œé€éè¼¸å…¥å…¶ä»–çš„ shared state ï¼Œè¼¸å‡ºæˆéœ€è¦çš„è³‡æ–™(derived data)ã€‚åœ¨è¼¸å…¥çš„ shared state æ›´æ–°æ™‚æ‰æœƒé‡æ–°è¨ˆç®—ã€‚ åœ¨shared stateæ›´æ–°æ™‚ï¼Œåªæœ‰è¨‚é–±è©² shared state çš„å…ƒä»¶æœƒé‡æ–°æ¸²æŸ“ã€‚ atom()æ¯å€‹atoméƒ½éœ€è¦ unique key å’Œé è¨­å€¼ï¼š 12345678910const todoList = atom({ key: 'todoList', default: [{task: 'çœ‹ä¸€æœ¬æ›¸',isComplete: false}, {task: 'æ‰“æƒå®¶è£¡',isComplete: true}]});const todoListfilter = atom({ key: 'todoListfilter', default: 'default'}); åœ¨componentä¸­ï¼ŒRecoil æä¾›äº†å¹¾å€‹ API ï¼šè·ŸuseState()å¾ˆåƒï¼Œä½†æ‹¬è™Ÿå…§æ”¾å…¥çš„ä¸æ˜¯é è¨­å€¼ï¼Œæ˜¯atomã€‚ useRecoilValue()ï¼šå–å€¼1const list = useRecoilValue(todoList); useSetRecoilState()ï¼šè¨­å€¼ä½¿ç”¨é€™å€‹ hook æ™‚ï¼Œshared stateæ”¹è®Šæ™‚componentä¸æœƒé‡æ–°æ¸²æŸ“ã€‚1const setTodos = useSetRecoilState(todoList); useRecoilState()ï¼šå–å€¼åŠè¨­å€¼1const [list,setTodos] = useRecoilState(todoList) useResetRecoilState()ï¼šèƒ½å°‡atomè¨­å®šç‚ºé è¨­å€¼ï¼Œ selector()æ¯å€‹selectorä¹Ÿéƒ½éœ€è¦ unique keyï¼Œä»¥åŠgetã€set(éå¿…è¦) methodã€‚ ä»¥ todoList ç‚ºä¾‹ï¼Œæœ‰äº† todoList å’Œç›®å‰çš„ filter ç‹€æ…‹ï¼Œå°±å¯ä»¥åˆ©ç”¨selectorè¨ˆç®—ç•¶å‰é é¢è¦é¡¯ç¤ºçš„è³‡æ–™äº†ã€‚ 1234567891011121314151617181920212223242526272829const filteredTodos = selector({ key: 'filteredTodos', get: ({get}) =&gt; { const filter = get(todoListfilter); const list = get(todoList); switch (filter) { case 'done': return list.filter((item) =&gt; item.isComplete); case 'undone': return list.filter((item) =&gt; !item.isComplete); default: return list; } }, //optional set: ({get, set}, newValue) =&gt; { ... }})const TodoList = () =&gt; { const todoList = useRecoilValue(filteredTodos); return (&lt;ul&gt; {todoList.map(todo=&gt;(&lt;li&gt;{todo.task}&lt;/li&gt;))} &lt;/ul&gt;)} å–å€¼å’Œè¨­å€¼éƒ½å¯ä»¥é€égetå–å¾—å…¶ä»–shared stateçš„è³‡æ–™ã€‚ éåŒæ­¥è³‡æ–™ä¸²æ¥atomåŠselectoréƒ½å¯ä»¥åˆ©ç”¨éåŒæ­¥çš„æ–¹å¼ä¸²æ¥è³‡æ–™ï¼š 12345678910111213const userID = atom({ key: 'userID', default: null,});const userData = selector({ key: 'userData', get: ({get}) =&gt; { const id = get(userID) const response = await fetchUserData({id}); return response.data; }}) åˆ©ç”¨useRecoilValue()ç²å¾—éåŒæ­¥çš„shared stateæ™‚ï¼Œå¯ä»¥æ­é… React çš„&lt;Suspense&gt;ä½¿ç”¨ä¾†è£½ä½œè¼‰å…¥æ•ˆæœã€‚å¦‚æœä¸æƒ³ï¼ŒRecoilä¹Ÿæœ‰å¦å¤–æä¾› API : useRecoilValueLoadable() useRecoilStateLoadable() ä¸åŒæ–¼useRecoilValue()å›å‚³ERRORæˆ–æ˜¯PROMISEï¼Œé€™å…©å€‹hooksåœ¨é‡åˆ°éåŒæ­¥ä¸²æ¥æ™‚æœƒå›å‚³å«æœ‰stateã€contentçš„ç‰©ä»¶ï¼š key/å›å‚³å…§å®¹ æˆåŠŸ å¤±æ•— loading state 'hasValue' 'hasError' 'loading' content å›å‚³çš„è³‡æ–™ error object Promise familyç³»åˆ— â† è¦ºå¾—å¾ˆé…·å¯ä»¥å¸¶å…¥å¤–éƒ¨å¼•æ•¸è‡³atomã€selectorä¸­çš„é…·æ±æ±ã€‚ atomFamily()æœ‰æ™‚éœ€è¦å‹•æ…‹ç”¢ç”Ÿatomæ™‚ï¼Œå°±å¯ä»¥ä½¿ç”¨atomfamily()ã€‚å®˜æ–¹èˆ‰äº†ä¸€å€‹ä¾‹å­ä¾†è¬›è§£ä½¿ç”¨æ™‚æ©Ÿï¼š å‡è¨­ä½ åšçš„æ˜¯ä¸€å€‹UIç·¨è¼¯é é¢ï¼Œä½¿ç”¨è€…å¯ä»¥å‹•æ…‹æ–°å¢å…ƒä»¶ã€è€Œä¸”æ¯å€‹å…ƒä»¶éƒ½æœ‰è‡ªå·±çš„å¤§å°ã€é¡è‰²ã€ä½ç½®â‹¯â‹¯ç­‰ç‹€æ…‹ã€‚ é€™æ™‚ä¸èƒ½ç¢ºå®šéœ€è¦å¹¾å€‹atomï¼Œåˆä¸æƒ³æŠŠå€‹åˆ¥å…ƒä»¶çš„æ¨£å¼å…¨éƒ¨å¡é€²ä¸€å€‹atomæ™‚ï¼Œæ‡‰è©²æ€éº¼è¾¦ï½ï¼Ÿåœ¨å®˜æ–¹æ¨è–¦å½±ç‰‡ï¼ˆ9:55-12:00ï¼‰æ¨å‡ºæ™‚ï¼Œå¯èƒ½é‚„æ²’æœ‰atomfamily()é€™å€‹èªæ³•ï¼Œç‚ºäº†è§£æ±ºå•é¡Œï¼Œå¤§å”é€éå¸¶å…¥ä¸é‡è¤‡çš„å¼•æ•¸å‹•æ…‹æ–°å¢atomï¼š 123456789const itemWithId = memorize(id =&gt; atom({ key: `item${id}`, default: { color: pink, position: {0,0} }}))const CanvasElement = ({elementID}) =&gt; { const [itemData, setItemData] = useRecoilValue(itemWithId(elementID)); return (...);} ç¾åœ¨Recoilæä¾›äº†æ›´æ–¹ä¾¿çš„atomFamily()ï¼š 123456789const itemFamily = atomFamily({ key: 'item', default: {...},});const CanvasElement = ({elementID}) =&gt; { const [itemData, setItemData] = useRecoilValue(itemFamily(elementID)); return (...);} é è¨­å€¼ é™¤äº†atomèƒ½æ”¾çš„ä¹‹å¤–ï¼Œé‚„èƒ½å¤ æ”¾å¸¶æœ‰åƒæ•¸ä¸”æœ‰å›å‚³å€¼çš„functionï¼š 12345const itemFamily = atomFamily({ key: 'item', default: param =&gt; setColor(param),}); selectorFamily(options)é¡ä¼¼selector()ï¼Œä½†æ›´å¼·å¤§çš„æ˜¯èƒ½å¸¶åƒæ•¸åˆ°getã€setä¸­ã€‚ 1234567891011const selectColor = selectorFamily({ key: 'selectColor', get: param =&gt; ({get}) =&gt; { return ... ; }, set: param =&gt; ({set,get}, newValue) =&gt; { return ... ; },}); atomFamily()çš„é è¨­å€¼å¯ä»¥æ”¾functionï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨selectFamily()ï¼š 1234567const item = atomFamily({ key: â€˜itemâ€™, default: selectorFamily({ key: 'colorSelect', get: param =&gt; ({get}) =&gt; selectColor(param); }),}); åŒä¸€å€‹selectFamily()æ¥æ”¶åˆ°ç›¸åŒçš„å¼•æ•¸æ™‚ï¼Œæœƒå›å‚³ç›¸åŒçš„selectorå¯¦é«”ã€‚ æœ€å¾Œä¸€å€‹åˆ¥å¿˜äº†&lt;RecoilRoot&gt;ï¼å¯ä»¥æœ‰è¤‡æ•¸å€‹&lt;RecoilRoot&gt;å…±å­˜ï¼Œä¸æœƒäº’ç›¸å½±éŸ¿ã€‚ä½†è‹¥æœ‰å·¢ç‹€çš„&lt;RecoilRoot&gt;ï¼Œæœ€å…§å±¤æœƒè¦†è“‹å¤–å±¤ã€‚ 123456789import { RecoilRoot } from 'recoil';function App() { return ( &lt;RecoilRoot&gt; &lt;ComponentThatUsesRecoil /&gt; &lt;/RecoilRoot&gt; );} åƒè€ƒè³‡æ–™ Recoil Doc Recoil GitHub å®˜æ–¹æ¨è–¦çš„å½±ç‰‡ Redux vs Recoil Recoil - a New State Management Library for React CodeSandbox Sample","link":"/2021/07/28/recoil/"},{"title":"transform vs positionï¼šç€è¦½å™¨æ¸²æŸ“çš„ç°¡å–®ä»‹ç´¹","text":"æœ‰å¤©ç¡è¦ºå‰çªç„¶æƒ³åˆ°ï¼ˆå°±æ˜¯é€™éº¼çªç„¶ï¼‰ï¼Œç”¨ transform è·Ÿ left, top éƒ½å¯ä»¥æ”¹è®Šå…ƒç´ ä½ç½®çš„è©±ï¼Œé‚£æ˜¯å·®åœ¨å“ªğŸ§ï¼Ÿå°±æŸ¥äº†ä¸€ä¸‹ï¼ŒåŸä¾†è·Ÿç€è¦½å™¨çš„æ¸²æŸ“æœ‰é—œä¿‚å•Šã€‚ é‡è¦çš„æ•¸å­—ï¼š60fpsä½œç‚ºå‰ç«¯å·¥ç¨‹å¸«æœ€é‡è¦çš„ä»»å‹™ä¹‹ä¸€æ‡‰è©²å°±æ˜¯è®“ä½ çš„ç¶²é äº’å‹•å¤šå¤šã€åˆæ»‘åˆé †ï¼Œä½¿ç”¨è€…ã€PMå¤§å®¶éƒ½é–‹é–‹å¿ƒå¿ƒã€‚ä»»ä½•å¡å¡æˆ–æ˜¯é¡«æŠ–çš„æ„Ÿè¦ºï¼ˆJudderingï¼‰éƒ½æœƒç ´å£é–‹é–‹å¿ƒå¿ƒã€‚ ç‚ºä»€éº¼æœƒå¡å¡ï¼Ÿç¾ä»Šå¤§å¤šç€è¦½å™¨çš„æ›´æ–°é »ç‡éƒ½æ˜¯æ¯ç§’60å¹€ï¼Œæ›ç®—ä¸‹ä¾†æ¯å€‹ç•«é¢ï¼ˆ1å¹€ï¼‰å¤§ç´„æœ‰ 16ms å·¦å³ä¾†æ¸²æŸ“ç•«é¢ï¼Œè½èµ·ä¾†å·²ç¶“æœ‰å¤ å°‘ã€‚ä½†ç€è¦½å™¨å®ƒé‚„æœ‰å…¶ä»–äº‹è¦è™•ç†ï¼Œæ‰€ä»¥å¤§ç´„åªèƒ½æ’¥ 10ms ä¾†è™•ç†ç•«é¢ã€‚ ç•¶äº‹æƒ…å¤ªå¤šï¼Œæ²’è¾¦æ³•åœ¨æ™‚é–“å…§è™•ç†å®Œæ™‚ï¼Œç€è¦½å™¨çš„ç•«é¢ç‡ï¼ˆæ¯ç§’å¹€æ•¸ï¼‰å°±æœƒä¸‹é™ï¼Œä½¿ç”¨è€…å°±æœƒæ„Ÿè¦ºåˆ°å¡å¡çš„ã€‚ è€Œæå‡æ•ˆèƒ½â€”â€”è®“ç€è¦½å™¨æ¸›å°‘è¦åšçš„äº‹ã€åªåšå¿…è¦çš„äº‹ï¼Œå°±è®Šå¾—å¾ˆé‡è¦äº†ï¼ åƒç´ ç®¡é“(The pixel pipeline)ç€è¦½å™¨æ¸²æŸ“çš„éç¨‹æœ‰äº”å€‹ä¸»è¦æ­¥é©Ÿï¼Œä¹Ÿæ˜¯å‰ç«¯å·¥ç¨‹å¸«æœ€èƒ½æ§åˆ¶çš„éƒ¨åˆ†ï¼šåœ–ç‰‡ä¾†æºï¼šRendering Performance JavaScriptï¼šä¸»è¦ç”¨ä¾†è™•ç†å½¢æˆè¦–è¦ºè®Šæ›´çš„å·¥ä½œï¼Œ Styleï¼šå¥—ç”¨ CSS è¦å‰‡åœ¨å°æ‡‰çš„å…ƒç´ ä¸Šï¼Œä¸¦è¨ˆç®—å…ƒç´ çš„æœ€çµ‚æ¨£å¼ Layoutï¼šè¨ˆç®—å…ƒç´ é–“çš„ç‰ˆé¢é…ç½®ã€‚ä¸€å€‹å…ƒç´ å¾€å¾€å¯ä»¥å½±éŸ¿è¨±å¤šå…¶ä»–å…ƒç´ ã€‚ Paintï¼šç¹ªè£½å…ƒç´ çš„è¦–è¦ºåŒ–æ•ˆæœï¼Œå¦‚æ–‡å­—ã€åœ–ç‰‡ã€é¡è‰²ã€é™°å½±ã€é‚Šæ¡†â‹¯â‹¯ç­‰ã€‚æç¹ªé€šå¸¸æ˜¯åœ¨å¤šé‡çš„å±¤(layers)ä¸Šé€²è¡Œã€‚ Compositeï¼šåˆæˆæ­¥é©Ÿã€‚å®Œæˆæç¹ªå¾Œï¼Œéœ€è¦å°‡ layers ä»¥æ­£ç¢ºçš„é †åºæç¹ªè‡³è¢å¹•ï¼ˆå°¤å…¶æ˜¯æœ‰é‡ç–Šçš„ç‹€æ³ç™¼ç”Ÿæ™‚ï¼‰ã€‚ ç•¶ Layoutã€Paintã€Compositing ä»»ä¸€æ­¥é©Ÿè¢«è§¸ç™¼æ™‚ï¼Œå®ƒå¾Œé¢çš„æ­¥é©Ÿä¹Ÿæœƒè·Ÿè‘—è¢«è§¸ç™¼ã€‚ç„¡éœ€è™•ç†åˆ°çš„æ­¥é©Ÿå‰‡æœƒè¢«è·³éã€‚æœ‰ä»¥ä¸‹é€™ä¸‰ç¨®æƒ…å¢ƒï¼š change Layout property ï¼šæ›´æ–°èˆ‡ç‰ˆé¢é…ç½®æœ‰é—œçš„å±¬æ€§ï¼Œå¦‚ï¼š widthã€height leftã€rightã€topã€bottom margin ç”±æ–¼é€™äº›å±¬æ€§æœƒå½±éŸ¿å…ƒç´ èˆ‡å…¶ä»–å…ƒç´ é–“çš„é—œä¿‚ï¼Œç€è¦½å™¨ä¸åªéœ€è¦è™•ç†è©²å…ƒç´ ã€ä¹Ÿå¿…é ˆæª¢æŸ¥æ‰€æœ‰å…¶ä»–å…ƒç´ ã€‚ä¹‹å¾Œæ‰é‡æ–°å°‡æ•´å€‹ç¶²é æ’ç‰ˆ(reflow)ï¼Œä¸¦é€²è¡Œå¾ŒçºŒçš„æ¸²æŸ“è¡Œç‚ºã€‚ change Paint propertyæ›´æ–°èˆ‡å…ƒç´ è¦–è¦ºç›¸é—œã€è€Œç„¡æ”¹é¢ç‰ˆé¢é…ç½®çš„å±¬æ€§ï¼Œåƒæ˜¯ï¼š background-image color ç³»åˆ— text ç³»åˆ— box-shadows border change Composite propertyè‹¥æ›´æ”¹çš„å±¬æ€§é Layout ã€ Paint å±¬æ€§ï¼Œå°±åªæœƒè§¸ç™¼ Compositeã€‚ç›®å‰ä¾†èªªæ˜¯æŒ‡é€™å…©å€‹å±¬æ€§ï¼š transform opacity ğŸ’¡ å¥½ç”¨çš„æŸ¥è©¢å·¥å…· ğŸ’¡CSS Triggers å¯ä»¥æŸ¥è©¢å„ css å±¬æ€§æœƒè§¸ç™¼çš„éšæ®µ çœ‹åˆ°é€™è£¡æœ‰ç‡ˆæ³¡å†’å‡ºä¾†å— ğŸ’¡ğŸ’¡ğŸ’¡ğŸ’¡ğŸ’¡ï¼Ÿä½¿ç”¨ left: 10px èˆ‡ transform: translateX(10px) æ™‚çœ‹èµ·ä¾†çš„æ•ˆæœå¯èƒ½ä¸€æ¨£ï¼ˆä¹Ÿå¯èƒ½ transform æ›´ smoothy ä¸€é»ï¼‰ï¼Œä½†ç€è¦½å™¨æ¸²æŸ“æ‰€éœ€çš„æˆæœ¬å·®ç•°å»å¾ˆå¤§ã€‚å“‡å–”çœŸçš„å¥½ç¥å¥‡ï¼ å¦å¤– Style ä¹Ÿæ˜¯æœ‰å¯ä»¥å„ªåŒ–çš„åœ°æ–¹ï¼Œåƒæ˜¯é¸æ“‡å™¨çš„è¤‡é›œåº¦å°±æœƒå½±éŸ¿ç€è¦½å™¨æŸ¥æ‰¾çš„æ™‚é–“ã€‚å¸Œæœ›ä¹‹å¾Œä¹Ÿå¯ä»¥ä¾†å¯«ä¸€ç¯‡ï¼æ¨è–¦å¯ä»¥é–±è®€ï¼š Optimizing CSS: ID Selectors and Other Myths åƒè€ƒè³‡æ–™(å…¼æ¨è–¦é–±è®€)é€™å…©ç¯‡æ˜¯åŒå€‹ Google å¤§å¸«å¯«çš„ï¼Œç°¡çŸ­æœ‰åŠ›ï¼š Simplify Paint Complexity and Reduce Paint Areas Rendering Performance å…¶ä»– Stick to Compositor-Only Properties and Manage Layer CountSmooth as Butter: Achieving 60 FPS Animations with CSS3CSS GPU Animation: Doing It Right","link":"/2021/08/14/render-performance/"},{"title":"styled-components èƒŒå¾Œçš„é­”æ³•: Tagged template","text":"å¯«äº†ä¸€é™£å­çš„ styled-componentsï¼Œæœ€è¿‘æ‰çŸ¥é“åŸä¾†styled.tagå¾Œé¢çš„``ï¼Œå°±æ˜¯ ES6 å¸¸å¸¸åœ¨å¯«çš„é‚£å€‹ï¼ˆæ‰“çˆ†è‡ªå·±çš„ç¬¨é ­ï¼‰ï¼Œå®ƒçš„åå­—æ˜¯ backtickã€‚é™¤æ­¤ä¹‹å¤–é‚„ç™¼ç¾äº†ç¥å¥‡çš„ç”¨æ³•ï¼Œç ”ç©¶äº†ä¸€ä¸‹è¦ºå¾—å¾ˆæœ‰è¶£ï¼Œå°¤å…¶é€™ç¯‡æ–‡ç« å¯«å¾—å¾ˆè©³ç´°ï¼ˆå®˜æ–¹æ¨è–¦ï¼‰ï¼ä»¥ä¸‹æ˜¯çœ‹å®Œä¹‹å¾Œåšçš„ç´€éŒ„ï¼Œå¦‚æœç¿’æ…£çœ‹è‹±æ–‡çš„è©±å¾ˆæ¨è–¦çœ‹çœ‹åŸæ–‡ï½ å…ˆå¾æœ€ç°¡å–®çš„é–‹å§‹8ï¼ ç¯„æœ¬å­—é¢å€¼ Template Literal / Interpolated String Literalä»¥å‰è¦ç”¨å¾ˆå¤š + ä¸²èµ·ä¾†çš„æ±æ±ï¼Œç¾åœ¨åªè¦ç”¨ backticks åŠ ä¸Š ${ è®Šæ•¸åç¨± }ï¼Œæ•´å€‹å¾ˆæ¸…çˆ½ï½backticks ä¹‹é–“çš„æ–·è¡Œã€ç©ºæ ¼ç­‰ä¹Ÿéƒ½æœƒè¢«ä¿ç•™ï¼ 123456789const myFavorite = 'Lotso';const flavour = 'strawberries'// before ES6const introduceMyBearInES5 = 'My favorite bear is '+ myFavorite + ', and his tommy smells like'+ flavour +'.';// ES6const introduceMyBearInES6 = `My favorite bear is ${myFavorite}, and his tommy smells like ${flavour}.`; ${ è®Šæ•¸åç¨± } ä¸­é™¤äº†å­—ä¸²ï¼Œä¹Ÿèƒ½æ”¾å…¥å„ç¨®é‹ç®—å¼ï¼Œç”šè‡³æ˜¯å‘¼å«å‡½å¼ï¼š 12345678910111213141516const getFullName = ({firstName, lastName}) =&gt; { return `${firstName} + ${lastName}`}const President = { firstName: 'Lotso', LastName: 'Bear' height: 50,}const introducePresident = `Our President is ${getFullName(President)}. He is ${President.height &gt; 80 ? 'tall' : 'short'}. `// 'Our President is Lotso Bear. // He is short.' æ¨™ç±¤æ¨¡ç‰ˆ tagged templateæ¨™ç±¤æ¨¡æ¿æŒ‡çš„æ˜¯åœ¨å‡½å¼å¾Œæ–¹ç›´æ¥ç”¨ä¸Š backticks ï¼Œå¾ˆæœ‰è¶£çš„æ˜¯å°å‡ºä¾†çš„argumentæœƒæ˜¯é™£åˆ—ï¼ 12345678910const printSomething = (...args) =&gt; { console.log(...args)}//ä¸€èˆ¬çš„å‡½å¼printSomething('a', 'b') // 'a b'//æ¨™ç±¤æ¨¡ç‰ˆprintSomething`` // ['']printSomething`I love Lotso` // ['I love Lotso'] é›–ç„¶æœ‰é»å·®ç•°ï¼Œä½†æ˜¯å…¶å¯¦è·Ÿä¸€èˆ¬çš„å‡½å¼ç›¸å·®ä¸é ã€‚ä½†å¦‚æœæ¨¡æ¿å­—ç¬¦ä¸²ä¸­æœ‰ä½¿ç”¨åˆ° placeholder (å°±æ˜¯é‚£å€‹ç†Ÿæ‚‰çš„${...})ï¼Œå°±æœƒç™¼ç”Ÿå¾ˆç¥å¥‡çš„äº‹æƒ…ï¼ 123456789101112const myFavorite = 'Lotso';const printSomething = (...args) =&gt; { console.log(...args)}/* å‘¼å« printSomething, ä¸¦å°‡æ¨¡ç‰ˆå­—ç¬¦ä¸²ä½œç‚ºå¼•æ•¸ä»£å…¥ */printSomething(`My favorite bear is ${myFavorite}.`) // 'My favorite bear is Lotso.'/* call printSomething as a tagged template literal(æ¨™ç±¤æ¨£æ¿å­—é¢å€¼)*/printSomething`My favorite bear is ${myFavorite}.`//[&quot;My favorite bear is &quot;, &quot;.&quot;], &quot;Lotso&quot; ç•¶éä½¿ç”¨ä¸€èˆ¬ä»£å…¥çš„å½¢å¼ã€è€Œæ˜¯åœ¨ printSomething å¾Œæ–¹ä½¿ç”¨æ¨™ç±¤æ¨£æ¿å­—é¢å€¼æ™‚ï¼Œæœƒå¾—åˆ°ä¸€ Array ä½œç‚ºç¬¬ä¸€å€‹è®Šæ•¸ï¼Œç¬¬äºŒå€‹å‰‡æ˜¯placeholder myFavorite çš„å€¼ã€‚è€Œç¬¬ä¸€å€‹ Array å…§çš„å€¼çœ‹èµ·ä¾†æ˜¯ç”± myFavorite æ‰€åœ¨çš„ä½ç½®å»å€éš”çš„ å†ä¾†å¤šå¡ä¸€å€‹æ’å…¥å€¼çœ‹çœ‹ï¼š 123456789const myFavorite = 'Lotso';const flavour = 'strawberries'printSomething`My favorite bear is ${myFavorite}, and his tommy smells like ${flavour}.`;/*** [&quot;My favorite bear is &quot;, &quot;, and his tommy smells like &quot;, &quot;.&quot;] * &quot;Lotso&quot; * &quot;strawberries&quot;**/ åœ¨å›å‚³å€¼ä¸­ï¼Œç¬¬ä¸€å€‹è®Šæ•¸æœƒæ˜¯ä¸€é™£åˆ—ï¼Œå…§æœ‰éæ’å…¥å€¼çš„æ‰€æœ‰å­—ä¸²ï¼›è€Œæ’å…¥å€¼å‰‡æœƒä¾åºæ’åˆ—åœ¨å¾Œæ–¹çš„è®Šæ•¸ä¸­ã€‚å†ä¾†çœ‹ä¸€æ¬¡æ¯”è¼ƒï¼š 123456789101112const myFavorite = 'Lotso';const flavour = 'strawberries'printSomething(`My favorite bear is ${myFavorite}, and his tommy smells like ${flavour}.`) // &quot;My favorite bear is Lotso, and his tommy smells like strawberries.&quot;printSomething`My favorite bear is ${myFavorite}, and his tommy smells like ${flavour}.`;/*** [&quot;My favorite bear is &quot;, &quot;, and his tommy smells like &quot;, &quot;.&quot;] * &quot;Lotso&quot; * &quot;strawberries&quot;**/ ç‰¹é»ä»‹ç´¹å®Œç•¢ï¼é‚£å®ƒç¥å¥‡å¥½ç”¨çš„åœ°æ–¹åœ¨å“ªè£¡å‘¢ï¼ï¼ï¼è«‹çœ‹ä»¥ä¸‹ï¼š åœ¨ styled-components ä¸­çš„å¦™ç”¨ç°¡å–®èˆ‰ä¸€å€‹ styled-components ä¸­çš„èªæ³•ï¼š 123456789const Button = styled.button` font-size: ${props =&gt; props.primary ? '2em' : '1em'};`// font-size: 2em;&lt;Button primary /&gt;// font-size: 1em;&lt;Button /&gt; å¯«èµ·ä¾†å¾ˆé †ï¼Œå¾ä¾†æ²’æƒ³éé€™æ˜¯æ€éº¼åšåˆ°çš„XDtagged template èµ·äº†ä»€éº¼ä½œç”¨ï¼Ÿ å…ˆä¾†çœ‹æ”¾å‡½å¼åœ¨æ’å…¥å€¼ä¸­æœƒå°å‡ºä»€éº¼ï¼š 123456789101112const printSomething = (...args) =&gt; { console.log(args)}printSomething(`font-size: ${(primary) =&gt; primary ? '2em' : '1em'}`)// &quot;font-size: (primary) =&gt; primary ? '2em' : '1em'&quot; &lt;- åªæ˜¯ä¸€å¨å­—ä¸²printSomething`font-size: ${(primary) =&gt; primary ? '2em' : '1em'}`/*** [&quot;font-size: &quot;, &quot;&quot;,]* (primary) =&gt; primary ? '2em' : '1em' &lt;- å¥½åƒæ˜¯å­—ä¸²åˆå¥½åƒæ˜¯å‡½å¼**/ magicï½ï½ï½é€™è£¡çš„ (primary) =&gt; primary ? '2em' : '1em' æ˜¯è²¨çœŸåƒ¹å¯¦çš„å‡½å¼ï¼ æ—¢ç„¶æ˜¯å‡½å¼ï¼Œé‚£å°±åªå‰©ä¸‹åŸ·è¡Œå®ƒé€™å€‹ä»»å‹™äº†ï¼ä¾†æ”¹å¯«ä¸€ä¸‹å¾ˆç°¡é™‹çš„ printSomethingï¼Œé †ä¾¿æ”¹åæˆ printStyles ï¼š 1234567891011121314151617181920212223242526let protoStyledComponent = { printStyles(...args) { const [literalArr, ...placeholders] = args; const styles = placeholders.reduce((result, expr, index) =&gt; { /* æœ€å¤§é‡é»ï¼šå¦‚æœæ˜¯å‡½å¼å°±åŸ·è¡Œå®ƒï¼ */ const value = typeof expr === 'function' ? expr(this.props) : expr; return result + value + literalArr[index + 1]; }, literalArr[0]); return styles; }}let component = Object.create(protoStyledComponent);component.props = { primary: true, color: 'pink' }; // å¡ä¸€äº›å‡çš„propscomponent.printStyles`font-size: ${(props) =&gt; props.primary ? '2em' : '1em'};color: ${(props)=&gt; props.color}`/*&quot;font-size: 2em;color: pink;&quot;*/ ç™»ç™»ï¼ï¼ï¼å¥½ç¥å¥‡Rï½ï½ï½çªç„¶å¤šç­è§£äº†ä¸€é»é»æ¯å¤©åœ¨å¯«çš„æ±è¥¿ï¼Œå¯«èµ·ä¾†å¥½åƒä¹Ÿæ›´é ­è…¦æ¸…æ¥šäº†ï¼å¾ŒçºŒçš„æ›´å¤šåº•å±¤è™•ç†ï¼Œå¯ä»¥çœ‹é€™ç¯‡ã€‚ åƒè€ƒè³‡æ–™The magic behind ğŸ’… styled-components","link":"/2021/07/19/tagged-template/"},{"title":"å¯æ¸¬è©¦çš„ JavaScript Ch0ã€Ch1","text":"æœ‰ä¸€æ¬¡è½åˆ°ã€Œå…ˆå¯«æ¸¬è©¦å†å¯«ç¨‹å¼ã€è¦ºå¾—å¤ªé…·äº†8ï½å°±å¾ˆæƒ³æˆç‚ºå¾ˆæœƒå¯«æ¸¬è©¦çš„äººï¼ˆä¹Ÿå°±æœƒé †ä¾¿è®Šæˆå¾ˆæœƒå¯«ç¨‹å¼ï¼ï¼Ÿï¼‰ã€‚å‰é™£å­è²·äº†é€™æœ¬æ›¸ï¼Œçœ‹äº†ä¸€åŠè¦ºå¾—æœ‰é»é›£XDæ‰€ä»¥å›é ­å†è®€ä¸€æ¬¡ã€å¯«ä¸‹ç­†è¨˜ï¼Œæ›´ç¢ºå®šè‡ªå·±æœ‰è®€é€²å»ğŸ£ï¼ˆå‰è¨€è·Ÿç¬¬ä¸€ç« å®Œå…¨æ²’æœ‰ç¨‹å¼çš„éƒ¨åˆ†ï¼Œè®šï¼ï¼‰ å‰è¨€æ—¢æœ‰çš„ç¨‹å¼ç¢¼ï¼Ÿã€ŠWork Effectively with Legacy Codeã€‹çš„ä½œè€…å®šç¾©æ—¢æœ‰çš„ç¨‹å¼ç¢¼(legacy code)ç‚ºæ²’æœ‰æ¸¬è©¦çš„ç¨‹å¼ç¢¼ã€‚ç•¶é€™äº›å¾åˆ¥è™•ä¾†åˆ°æˆ‘å€‘æ‰‹ä¸­ï¼Œæˆ–è€…å¾æˆ‘å€‘æ‰‹ä¸­å»åˆ°å…¶ä»–é–‹ç™¼äººå“¡æ‰‹ä¸Šæ™‚ï¼Œéœ€è¦æ–°å¢åŠŸèƒ½ã€é™¤éŒ¯ã€æˆ–æ˜¯ç‚ºå®ƒæ’°å¯«æ¸¬è©¦æ™‚ï¼Œå¾ˆå¤šäººæœƒé¸æ“‡æ•´å€‹é‡å¯«ä»¥é˜²æ”¹Aå£Bã€‚è€Œé¿å…å¯«å‡ºé›£ä»¥ç¶­è­·çš„æ—¢æœ‰çš„ç¨‹å¼ç¢¼çš„æœ€ä½³æ–¹æ³•å°±æ˜¯å¥½å¥½å¯«æ¸¬è©¦ã€‚ é¿å…é€ æˆç½é›£çš„åŸå› ï¼šé«˜è¤‡é›œåº¦ã€ç·Šå¯¦è€¦åˆå¯«ç¨‹å¼çš„æ™‚å€™å¦‚æœèƒ½éš¨æ™‚æ³¨æ„åˆ°æ˜¯å¦å…·æœ‰å¯æ¸¬è©¦æ€§(testability)ï¼Œå°±æ›´å®¹æ˜“èƒ½å¯«å‡ºç›¸å°æ‡‰çš„æ¸¬è©¦ç¨‹å¼ã€‚è€Œé€™æ¨£çš„ç¨‹å¼ä¹Ÿç›¸å°æ›´å®¹æ˜“ä¿æŒä½è¤‡é›œåº¦ã€é¬†æ•£è€¦åˆçš„ç‹€æ…‹ã€‚ ä»€éº¼æ˜¯å¯æ¸¬è©¦(testable)çš„ç¨‹å¼ï¼Ÿå°±æ˜¯ç¬¬ä¸€ç« çš„å…§å®¹äº†ï¼š ç¬¬ä¸€ç« ï¼šå¯æ¸¬è©¦çš„ JavaScriptæ—¢æœ‰çš„è»Ÿé«”é–‹ç™¼æµç¨‹è»Ÿé«”é–‹ç™¼æµç¨‹æ˜¯ä¸€å¥—å¯ä»¥é‡è¤‡å¯¦è¡Œçš„ä½œæ¥­æµç¨‹ï¼Œé€éæ¨™æº–åŒ–èˆ‡è¦å‰‡è©±é€™äº›æµç¨‹ä¾†æ”¹å–„é–‹ç™¼äººå“¡çš„ç¨‹å¼ç¢¼å“è³ªâ€”â€”ç„¡è‡­èŸ²ã€ç„¡ç¼ºå¤±ã€‚ï¼ˆä½†é–‹ç™¼äººå“¡çš„å€‹äººæ„å¿—ä¹Ÿæ˜¯å¾ˆé‡è¦çš„XD) æ•æ·é–‹ç™¼ Agile Developmentå› æ‡‰ç€‘å¸ƒå¼(waterfall model)è€Œç”Ÿã€‚æ•æ·é–‹ç™¼æŠŠä»»å‹™åˆ‡æˆè¼ƒå°çš„å–®ä½ã€ç¸®çŸ­é‹ä½œé€±æœŸï¼Œè®“æ¯å€‹ç›¸é—œäººå“¡éƒ½ä¸€ç›´æœ‰äº‹å¯ä»¥åšã€äººå“¡é–“çš„åˆä½œä¹Ÿæœƒæ›´å¯†åˆ‡ã€‚ ç€‘å¸ƒå¼ï¼šä¾åºåŸ·è¡Œæ¯å€‹ç¨ç«‹ã€ä¸å¹³è¡Œçš„é–‹ç™¼æµç¨‹ï¼Œä¾‹å¦‚ï¼šå…ˆå¯«è¦æ ¼â†’å¯«ç¨‹å¼â†’åšæ¸¬è©¦â†’éƒ¨ç½²ã€‚ æ•æ·æ¸¬è©¦æœ¬èº«æ²’æœ‰è¦ç¯„æ€éº¼å¯«ç¨‹å¼ã€ä¹Ÿä¸ä¸€å®šæœƒæå‡é–‹ç™¼é€Ÿåº¦/å“è³ªï¼Œä½†æ¯”èµ·ç€‘å¸ƒå¼é–‹ç™¼ï¼Œå®ƒæ“æœ‰æ›´å¤§çš„å½ˆæ€§ï¼Œåœ¨éœ€æ±‚è®Šæ›´æ™‚èƒ½æ›´å¿«å°‡å…¶ç´å…¥é–‹ç™¼æµç¨‹ä¸­ã€‚ æ¸¬è©¦é©…å‹•é–‹ç™¼ Test-Driven Development(TDD)å…ˆå¯«æ¸¬è©¦å†é–‹å§‹é–‹ç™¼ã€‚TDDä¹Ÿæ˜¯é¿å…å‰è¨€ä¸­æåˆ°çš„æ—¢æœ‰çš„ç¨‹å¼ç¢¼çš„æœ€å¥½æ–¹æ³•ã€‚ è¡Œç‚ºé©…å‹•é–‹ç™¼ Behavior-Driven Development(BDD)å»ºç«‹åœ¨TDDä¹‹ä¸Šï¼Œé€éä½¿ç”¨è€…æƒ…å¢ƒï¼ˆuser storiesï¼‰ä¾†å®šç¾©ç¨‹å¼çš„è¦æ ¼ã€æœŸæœ›çš„çµæœã€‚ æ¸¬è©¦ã€Œå³ã€é©…å‹•é–‹ç™¼ Test-While-Driven Development(TWDD)ä½œè€…æå‡ºçš„è»Ÿé«”é–‹ç™¼åšæ³•ï¼Œé–‹ç™¼èˆ‡æ¸¬è©¦å¹¾ä¹åŒæ™‚å®Œæˆï¼šå¯«ä¸€éƒ¨åˆ†é–‹ç™¼ã€éš¨å¾Œè£œä¸Šæ¸¬è©¦ï¼›æˆ–è€…å¯«ä¸€äº›æ¸¬è©¦å¾Œé¦¬ä¸Šå¯«ä¸Šç¨‹å¼ã€‚ å°çµç„¡è«–æ˜¯ä½¿ç”¨ä½•ç¨®æ–¹å¼ï¼Œç ”ç©¶æŒ‡å‡ºæ¸¬è©¦çš„æ•¸é‡èˆ‡ç¨‹å¼çš„å“è³ªæˆæ­£æ¯”â€”â€”ç„¡è«–æ˜¯åœ¨é–‹ç™¼å‰ã€ä¸­ã€å¾Œï¼Œèƒ½å¤ å¤šå¯«ä¸€é»æ¸¬è©¦éƒ½æ˜¯çµ•å°ç„¡å®³çš„ã€‚ å¯æ¸¬è©¦çš„ç¨‹å¼ç¢¼å°±æ˜¯å®¹æ˜“åšæ¸¬è©¦çš„ç¨‹å¼ç¢¼ï¼Œè€Œé€™æ¨£çš„ç¨‹å¼ç¢¼é€šå¸¸ä¹Ÿå®¹æ˜“è¢«ç¶­è­·ã€å®¹æ˜“è¢«ç­è§£â€”â€”å¥½æ‡‚å¥½ debugï¼ å¯ç¶­è­·çš„ç¨‹å¼ç¢¼ï¼šä¸è¦ä¸€å¤§å †äº‚ä¸ƒå…«ç³Ÿå¯«åœ¨ä¸€èµ·ï¼ çŸ­å° ç¨ç«‹ å¯äº†è§£çš„ç¨‹å¼ç¢¼ å®Œæ•´çš„è¨»è§£ æœ‰æ„ç¾©çš„å‘½å å‰å¾Œä¸€è‡´çš„ç¨‹å¼ç¢¼æ…£ä¾‹ æ¸¬è©¦çš„ç¨®é¡å–®å…ƒæ¸¬è©¦ï¼ˆunit testingï¼‰ä»¥ç¨‹å¼ä¸­æœ€å°çš„é‚è¼¯å–®ä½å¯«æ¸¬è©¦ç¨‹å¼ï¼Œä¾†é©—è­‰é‚è¼¯æ˜¯å¦æ­£ç¢ºï¼Œé€šå¸¸ç”¨åœ¨æ¸¬è©¦ pure functionï¼šè¼¸å…¥ input æ˜¯å¦æœ‰é”åˆ°é æœŸä¸­çš„ outputã€‚ æ•´åˆæ¸¬è©¦ï¼ˆintegration testingï¼‰æ¸¬è©¦æ•´åˆå¤šå€‹é‚è¼¯ä¸‹çš„æƒ…æ³ï¼Œç¢ºä¿æ¨¡çµ„èˆ‡æ¨¡çµ„ä¹‹é–“çš„äº’å‹•è¡Œç‚ºæ˜¯æ­£å¸¸çš„ã€‚ä»¥å‰ç«¯ä¾†èªªçš„è©±å¯èƒ½æ˜¯ä¸€å€‹ React Component ä¸­çš„å„ç¨®è¡Œç‚ºï¼ˆè·ŸDOMäº’å‹•ã€ä¸²æ¥APIç­‰ç­‰ï¼‰ã€‚ æ•ˆèƒ½èˆ‡è² è¼‰æ¸¬è©¦ï¼ˆperformance and loading testingï¼‰ç¢ºèªç¨‹å¼åŸ·è¡Œæ˜¯å¦ç¬¦åˆè¦æ ¼ ç«¯å°ç«¯æ¸¬è©¦ï¼ˆEnd-to-End testï¼‰é€™æ˜¯ä½œè€…æ²’æœ‰æåˆ°çš„éƒ¨åˆ†ï¼ŒE2E testå¯ä»¥æ’°å¯«ç¨‹å¼ä¾†æ¨¡æ“¬ä½¿ç”¨è€…æ“ä½œç¶²é çš„æµç¨‹ï¼ˆå°±æ˜¯æŠŠäººå·¥çš„éƒ¨åˆ†è½‰è®Šæˆç¨‹å¼åŸ·è¡Œï¼‰ã€‚","link":"/2021/07/30/testablejs0001/"},{"title":"å¯æ¸¬è©¦çš„ JavaScript Ch2 è¤‡é›œåº¦ï¼ˆä¸Šï¼‰","text":"é›–ç„¶å®Œå…¨ç²¾ç¢ºæ¸¬é‡ç¨‹å¼è¤‡é›œåº¦çš„æ–¹æ³•æ˜¯ä¸å­˜åœ¨çš„ï¼Œä½†æœ‰å¹¾å€‹é‡è¦çš„æŒ‡æ¨™èƒ½å¤ æ¸¬é‡å‡ºéƒ¨åˆ†çš„ç¨‹å¼è¤‡é›œåº¦ï¼š ç¨‹å¼ç¢¼å¤§å°(code size) å¾ªç’°è¤‡é›œåº¦(cyclomatic complexity) æ‰‡å…¥ æ‰‡å‡º â‹¯â‹¯ç­‰ç­‰å¯ä»¥æ¸¬é‡å‡ºéƒ¨åˆ†çš„ç¨‹å¼è¤‡é›œåº¦ã€‚ä½¿ç”¨é€™äº›é …ç›®å»æª¢è¦–è‡ªå·±çš„ç¨‹å¼ç¢¼ï¼Œæ˜¯å»ºç«‹å¯æ¸¬è©¦çš„ç¨‹å¼çš„è‰¯å¥½é–‹å§‹ã€‚ ç¨‹å¼ç¢¼å¤§å°ï¼ˆCode Sizeï¼‰é›–ç„¶æ•´å€‹å°ˆæ¡ˆä¸­å¿…è¦çš„ç¨‹å¼ç¢¼çš„æ•¸é‡ä¸å¤ªå¯èƒ½æ”¹è®Šï¼Œä½†æ¯å€‹å‡½å¼çš„å¤§å°ã€æˆ–æ˜¯æ¯å€‹æª”æ¡ˆä¸­çš„å‡½å¼æ•¸é‡å¯ä»¥æ”¹è®Šçš„ï¼ˆæª”æ¡ˆå…§çš„å‡½å¼æ‡‰è©²ç›¡é‡ç›¸é—œï¼‰ï¼ å‘½ä»¤èˆ‡æŸ¥è©¢å°‡å‘½ä»¤(command)èˆ‡æŸ¥è©¢(query)åˆ†é–‹æ˜¯ç¶­æŒå‡½å¼æœ€å°å°ºå¯¸çš„æ–¹å¼ä¹‹ä¸€ï¼š å‘½ä»¤ï¼šå¯ä»¥è¦–ç‚º setters ï¼Œ ç‚º åšæŸä»¶äº‹ çš„å‡½å¼ æŸ¥è©¢ï¼šå¯ä»¥è¦–ç‚º getters ï¼Œ ç‚º å‚³å›æŸå€‹çµæœ çš„å‡½å¼ ä½¿ç”¨é€™ç¨®æŠŠè®€èˆ‡å¯«åˆ†é–‹çš„æ–¹å¼æ’°å¯«å‡½å¼ï¼Œé™¤äº†èƒ½ç²¾ç°¡ç¨‹å¼ã€æé«˜å¯è®€æ€§å¤–ï¼Œæ¸¬è©¦æ™‚çš„å½ˆæ€§ä¹Ÿæ›´é«˜ã€‚ ä¸å¥½çš„ç¤ºç¯„ï¼š 1234567891011121314151617181920212223function configure(values) { const fs = require('fs'); const config = { docRoot: '/root' }; let key; let state; for(key in values) { config[key] = values[key] } try { state = fs.statSync(config.docRoot); if(!state.isDirectory()){ throw new Error('is not valid'); } } catch(e) { console.log(`** ${config.docRoot} does not exist`) return; } //..validate other values... return config;} é€™æ®µç¨‹å¼ä¸­é™¤äº†å°‡ values ä¸­çš„å€¼å¯«å…¥ config ï¼Œé‚„è¦é©—è­‰è³‡æ–™ï¼Œé™¤äº†æ¸¬è©¦å¯«èµ·ä¾†æœƒå¾ˆé¾å¤§ã€æ²’æœ‰ç„¦é»å¤–ï¼Œä¹Ÿä¸èƒ½å–®ç¨é©—è­‰configçš„å…§å®¹ã€‚ å¦‚æœå°‡é€™æ®µç¨‹å¼ç¢¼æ‹†å¯«ï¼š 1234567891011121314151617181920212223242526function configure(values) { const config = { docRoot: '/root' }; let key; for(key in values) { config[key] = values[key] } validateDocRoot(config); validateSomething(config); return config;}function validateDocRoot(config) { const fs = require('fs'); cosnt state = fs.statSync(config.docRoot); if(!state.isDirectory(ï¼‰){ throw new Error('is not valid'); }}//validate other values...function validateSomething(config) { ...} ç¬é–“è®Šå¾—æ¸…æ¥šå¤šäº†ï¼ä¹Ÿèƒ½é‡å°å–®ä¸€é …ç›®å»åšé©—è­‰ã€æ¸¬è©¦ã€‚ä½œè€…å¾ŒçºŒé‚„æœ‰åšä¸€äº›æ”¹è‰¯ï¼Œä½†é€™å€‹æ­¥é©Ÿå°±å¾ˆèƒ½èªªæ˜å°‡å‘½ä»¤èˆ‡æŸ¥è©¢åˆ†é–‹çš„å¥½è™•äº†ã€‚ JSLinté€™æœ¬æ›¸æ˜¯ 2014 å¹´å‡ºç‰ˆçš„ï¼Œç¾åœ¨æ¯”è¼ƒå¸¸ç”¨çš„é¡ä¼¼å·¥å…·æ˜¯ ESLintã€‚ç”¨ä¾†åˆ†æç¨‹å¼ç¢¼ä¸­æ˜¯å¦æœ‰**ä¸è‰¯çš„é¢¨æ ¼ (style)ã€èªæ³• (syntax) ä»¥åŠèªæ„ (semantics)**ï¼Œä»¥æé«˜ç¨‹å¼ç¢¼çš„å¯è®€æ€§ã€‚ å¾ªç’°è¤‡é›œåº¦ Cyclomatic ComplexityæŒ‡çš„æ˜¯åœ¨ç¨‹å¼ä¸­ç„¡ç›¸ä¾é—œè¯çš„ç¨‹å¼ç¢¼æ•¸é‡ã€‚å³ç‚ºäº†æ¸¬è©¦æ‰€æœ‰ç¨‹å¼ç¢¼ï¼Œæ‰€éœ€æ’°å¯«çš„å–®å…ƒæ¸¬è©¦ä¹‹æœ€å°æ•¸é‡ï¼ˆæ¸¬è©¦è¦†è“‹ç‡100%æ™‚ï¼Œæ‰€éœ€è¦æœ€å°çš„å–®å…ƒæ¸¬è©¦æ•¸é‡ï¼‰ã€‚ ğŸ’¡ æ¸¬é‡å·¥å…·ï¼š JSmeter jecheckstyle + Jenkins VScode ä¸­å¯ä»¥å®‰è£ CodeMetrics ä»¥ä¸‹æ˜¯ä¸€å€‹å¾ªç’°è¤‡é›œåº¦ 2 çš„å‡½å¼ï¼š 1234567const sum = (a, b) =&gt; { if(typeof a !== typeof b){ throw new Error(&quot;can't sum different types!&quot;); } else { return a + b } } æŸ¥æ‰¾è¡¨å¾ªç’°è¤‡é›œåº¦è¼ƒé«˜æ™‚ï¼Œé€šå¸¸è¡¨ç¤ºç¨‹å¼ç¢¼å…§æœ‰è¨±å¤š if/else æˆ–æ˜¯ switch é™³è¿°å¥ï¼Œå°‡ä¹‹æ”¹å¯«ç‚ºæŸ¥æ‰¾è¡¨ï¼š 123456789101112131415161718192021// if/elseé™³è¿°å¥const doSomething = a =&gt; { if(a === 'x') { doX(); } else if (a === 'y') { doY() } else { doZ(); }}// æŸ¥æ‰¾è¡¨const doSomething = a =&gt; { const lookup = { x: doX, y: doY }; const default = doZ; lookup[a] ? lookup[a]() : default();} æ”¹å¯«å¾Œé›–ç„¶æ²’æœ‰æ¸›å°‘éœ€æ’°å¯«çš„å–®å…ƒæ¸¬è©¦æ•¸é‡ï¼Œä½†æ’°å¯«çš„åšæ³•æœ‰æ‰€æ”¹è®Šï¼š if/elseï¼šå°å–®ä¸€å‡½å¼æ’°å¯«å¤šå€‹å–®å…ƒæ¸¬è©¦12345678910111213describe('Test doSomething', () =&gt; { test('a is x', () =&gt; { ... }) test('a is y', () =&gt; { ... }) test('default', () =&gt; { ... })}); æŸ¥æ‰¾è¡¨ï¼šå°å¤šå€‹è¼ƒå°çš„å‡½å¼å¯«å°æ‡‰çš„å–®å…ƒæ¸¬è©¦1234567891011121314151617describe('Test lookup x', () =&gt; { test('doX', () =&gt; { ... })});describe('Test lookup y', () =&gt; { test('doY', () =&gt; { ... })});describe('Test default', () =&gt; { test('doZ', () =&gt; { ... })}); å¯ç¶­è­·æ€§æé«˜ï¼Œæ„Ÿè¦ºä¹Ÿæ›´å¥½è®€äº†ï¼ é‡è¤‡ä½¿ç”¨ Reuseæ¸›å°‘ç¨‹å¼ç¢¼çš„å¤§å°æœ€å¥½çš„æ–¹å¼å°±æ˜¯é™ä½æ’°å¯«æ•¸é‡ã€‚ä¸€å€‹å…¸å‹çš„æ‡‰ç”¨ç¨‹å¼å¤§ç´„æœ‰ 85% ä»¥ä¸Šæ˜¯ä½¿ç”¨ä»–äººæ’°å¯«å¥½çš„ç¨‹å¼ç¢¼ï¼ˆå¥—ä»¶ã€æ¡†æ¶ç­‰ç­‰ï¼‰ï¼Œåªæœ‰ 15% æœƒæ˜¯é–‹ç™¼è€…è‡ªè¡Œæ’°å¯«çš„ã€‚ é™¤äº†å–„ç”¨ç¬¬ä¸‰æ–¹è³‡æºï¼Œæ›´é‡è¦çš„æ˜¯åœ¨é€™ 15% ä¸­é‡è¤‡è‡ªå·±çš„ç¨‹å¼ç¢¼ã€‚å°æ–¼é‡è¤‡å‡ºç¾çš„ç¨‹å¼ç¢¼ä¸è¦æœ‰ã€Œå°±å¤šå‡ºé€™ä¸€æ¬¡è€Œå·²ã€çš„å¿ƒæ…‹ã€‚","link":"/2021/08/04/testablejs0201/"},{"title":"å¯æ¸¬è©¦çš„ JavaScript Ch2 è¤‡é›œåº¦ï¼ˆä¸‹ï¼‰","text":"æ‰‡å‡ºèˆ‡æ‰‡å…¥æ‰‡å‡º Fan-outæ‰‡å‡ºçš„å®šç¾©æ˜¯ä¸€å€‹å‡½å¼çš„å…§éƒ¨æµæ•¸ç›®åŠ ä¸Šè©²å‡½å¼æ›´å‹•åˆ°çš„å…¨åŸŸè³‡æ–™æ•¸ç›®ä»¥ä¸‹ç‹€æ³éƒ½å¯ä»¥è¢«ç®—ä½œæ˜¯å‡½å¼Açš„å…§éƒ¨æµï¼š A å‘¼å« B B å‘¼å« A ï¼Œä¸” A å›å‚³ä¸€å€‹å€¼ã€B æœƒåˆ©ç”¨é€™å€‹å€¼ C å‘¼å« A å’Œ B ï¼Œä¸¦æŠŠ A çš„è¼¸å‡ºå€¼å‚³çµ¦ B æ‰‡å…¥ Fan-inæ‰‡å…¥çš„å®šç¾©æ˜¯å…§éƒ¨æµé€²å…¥è©²å‡½å¼çš„æ•¸ç›®ï¼ŒåŠ ä¸Šå¾è©²å‡½å¼å–ç”¨å…§å®¹çš„è³‡æ–™çµæ§‹æ•¸ç›®ã€‚å¤§å¤šæƒ…æ³ä¸‹å¤§çš„æ‰‡å…¥æ•¸æ˜¯å¥½çš„ï¼Œè¡¨ç¤ºæœ‰è¶Šå¤šå…±ç”¨ç¨‹å¼çš„é‡è¤‡ä½¿ç”¨ã€‚ å°çµé«˜çš„æ‰‡å…¥æ•¸èˆ‡æ‰‡å‡ºæ•¸å¯èƒ½æš—ç¤ºé€™å€‹å‡½ç¤ºåšäº†å¤ªå¤šäº‹ï¼Œéœ€è¦è¢«é‡æ§‹ã€‚ è€¦åˆ Couplingæ‰‡å‡ºæ˜¯è¨ˆç®—ä¸€å€‹æ¨¡çµ„æˆ–å‡½å¼éœ€æ±‚çš„ç›¸ä¾æ¨¡çµ„èˆ‡ç‰©ä»¶çš„æ•¸é‡ï¼Œè€¦åˆå‰‡æ˜¯è¡¨é”é€™äº›æ¨¡çµ„ã€ç‰©ä»¶ä¹‹é–“çš„é—œè¯æƒ…æ³ã€‚è€¦åˆçš„ç¨‹åº¦ç”±é«˜åˆ°ä½åˆ†æˆå…­å€‹ç­‰ç´šï¼š å…§å®¹è€¦åˆ(5åˆ†)ï¼šç›´æ¥ä¿®æ”¹ç‰©ä»¶æœ¬èº«çš„ç‹€æ…‹1person.name = 'Lotso'; å…±ç”¨è€¦åˆ(4åˆ†)ï¼šå…©å€‹ç‰©ä»¶å…±ç”¨ä¸€å€‹å…¨åŸŸè®Šæ•¸ï¼Œå½¼æ­¤å°±æ˜¯å…±ç”¨è€¦åˆé—œä¿‚ã€‚123456789let global = 'global';const a = () =&gt; { global = 'a';};const b = () =&gt; { global = 'b';} æ§åˆ¶è€¦åˆ(3åˆ†)ï¼šåˆ©ç”¨æ——æ¨™(flag)æˆ–åƒæ•¸è¨­å®šæ§åˆ¶å¤–éƒ¨ç‰©ä»¶çš„é‹ä½œï¼š1const whiteRabbit = new AbstractRabbit({color: 'white'}); æˆ³è¨˜è€¦åˆ(2åˆ†)ï¼šç¶“ç”±åƒæ•¸å‚³éä¸€ç­†è³‡æ–™çµ¦ç‰©ä»¶Aï¼ŒAåªæœƒç”¨åˆ°è©²è³‡æ–™çš„éƒ¨åˆ†å…§å®¹é€™è£¡çš„ makeBread åªç”¨åˆ° bread çš„ä¸‰å€‹å±¬æ€§ï¼Œæ²’æœ‰ç”¨åˆ° nameï¼š123456789101112Oven.prototype.makeBread = function({type, size, flavor}) { return new Bread(type, size, flavor)};const bread = { name: 'bread1', type: 'wheat', size: 99, flavor: 'macha'};Oven.makeBread(bread); è³‡æ–™è€¦åˆ(1åˆ†)ï¼šç¶“ç”±åƒæ•¸å‚³éä¸€ç­†è³‡æ–™çµ¦ç‰©ä»¶Aï¼Œä¸”æ²’æœ‰å°‡è³‡æ–™çš„æ§åˆ¶æ¬Šè½‰çµ¦å¤–éƒ¨ç‰©ä»¶ã€‚åœ¨ç¬¬ä¸‰ç« æœƒæœ‰æ›´ç´°çš„æ¢è¨ã€‚ ç„¡è€¦åˆï¼šå…©å€‹ç‰©ä»¶ç„¡é—œï½ï½è®šï¼ å°‡è€¦åˆç¨‹åº¦è¶Šå°ï¼ˆè³‡æ–™è€¦åˆã€ç„¡è€¦åˆï¼‰ï¼Œæ¸¬è©¦èµ·ä¾†è¶Šå®¹æ˜“ï¼ å¯¦é«” Instantiationå¯¦é«”åŒ–éç¨ç”Ÿ(nonsingleton)çš„å…¨åŸŸç‰©ä»¶é›–ä¸å±¬æ–¼ä¸Šè¿°çš„æ­£è¦è€¦åˆé¡å‹ï¼Œä½†æ˜¯ä¸€ç¨®ä»‹æ–¼å…§å®¹è€¦åˆèˆ‡å…±ç”¨è€¦åˆä¹‹é–“ã€éå¸¸ç·Šå¯†çš„è€¦åˆé¡å‹ã€‚ åœ¨ä¸ä½¿ç”¨æ­¤ç‰©ä»¶æ™‚ï¼Œå¿…é ˆæ‘§æ¯€å®ƒã€‚ ç‰©ä»¶å¯¦é«”è¶Šå°‘ï¼Œç¨‹å¼ç¢¼è¤‡é›œåº¦è¶Šä½ã€‚å¦‚æœç™¼ç¾ç¨‹å¼ç¢¼ç”¨äº†å¤ªå¤šç‰©ä»¶ã€å°±æ˜¯æ™‚å€™é‡æ–°æ€è€ƒç¨‹å¼æ¶æ§‹äº†ï¼ ç¨ç”Ÿ/éç¨ç”Ÿçš„æ¦‚å¿µå¯ä»¥åƒè€ƒé€™å€‹ï¼Œæ»¿å¥½æ‡‚çš„ï¼ ç›¸ä¾æ€§æ³¨å…¥ Dependency Injectionå…ˆä¾†çœ‹ä¸€å€‹ç·Šå¯†è€¦åˆçš„ä¾‹å­ï¼š 1234567function setParty() { const djPlayer = new DJPlayer(); const dishes = new Dishes(); this.placeDJPlayer(djPlayer); this.placeDishes(dishes);} ç•¶æº–å‚™è¦æ¸¬è©¦é€™å€‹ç¨‹å¼çš„æ™‚å€™ï¼Œéœ€è¦æº–å‚™ DJPlayer ç‰©ä»¶è·Ÿ Dishes ç‰©ä»¶ï¼ˆé€™æœƒä½¿æ¸¬è©¦è®Šå¾—å›°é›£ï¼‰ã€‚å–®å…ƒæ¸¬è©¦æœƒå¸Œæœ›ä¸è¦ä¾é å¤–éƒ¨ç›¸ä¾æ€§å°±èƒ½ç¨ç«‹æ¸¬è©¦ setPartyã€‚ é€™æ™‚å¯ä»¥ä½¿ç”¨æ³¨å…¥(injection)å»æ¸›å°‘è€¦åˆç¨‹åº¦ï¼š 1234function setParty(djPlayer, dishes) { this.placeDJPlayer(djPlayer); this.placeDishes(dishes);} é€™æ™‚å€™æœƒæœ‰å€‹ç–‘å•ï¼Œå¦‚æœé€™è£¡æ³¨å…¥äº†ä¸€å€‹ç‰©ä»¶ï¼Œé‚£é‚„æ˜¯æœ‰ä¸€å€‹åœ°æ–¹éœ€è¦å»å»ºç«‹å®ƒå•Šï¼ï¼ï¼æ²’éŒ¯ï¼Œä½œè€…æŒ‡å‡ºé€™ä»¶äº‹é€šå¸¸æœƒæ˜¯åœ¨ç¨‹å¼æˆ–æ¸¬è©¦çš„é–‹é ­ã€‚é€™æ¨£çš„åšæ³•ä½¿å¾—ä»»æ„ç‰©ä»¶æ›´å®¹æ˜“èˆ‡å¦ä¸€å€‹ç‰©ä»¶åšäº¤æ›¿ã€‚ è€Œä¸”åœ¨å¯«æ¸¬è©¦æ™‚ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è™›æ§‹çš„ç‰ˆæœ¬ä¾†æ›¿æ›æ³¨å…¥çš„ç‰©ä»¶ï¼Œä½¿æ¸¬è©¦æ›´åŠ å®¹æ˜“æ’°å¯«ã€‚ æœ¬ç« é‡é»å›é¡§ ç›¡å¯èƒ½æ¸¬é‡ç¨‹å¼ç¢¼çš„è¤‡é›œåº¦ï¼Œé€²è€Œæ•´ç†ç¨‹å¼ç¢¼ã€æé«˜å¯æ¸¬è©¦æ€§ã€å¯ç¶­è­·æ€§ã€‚ ç¨‹å¼é–“çš„ç›¸ä¾æ€§ï¼ˆè€¦åˆï¼‰ä½¿å¾—æ¸¬è©¦è®Šå¾—å›°é›£ï¼Œå¯ä»¥ä½¿ç”¨æ³¨å…¥çš„æ–¹å¼è§£æ±ºã€‚ é™ä½ç¨‹å¼ç¢¼çš„è¤‡é›œåº¦ç„¡éå°±æ˜¯äº†è§£ä½•è™•è¤‡é›œä¸¦ä¸”é‡æ§‹ã€‚ä½œè€…æ¨è–¦å…©æœ¬æ›¸ Refactoring: Improving the Design of Existing Code Code Complete: A Practical Handbook of Software Construction å®Œå…¨æ’é™¤è¤‡é›œåº¦æ˜¯ä¸å¯èƒ½çš„ï¼Œä½†å¯ä»¥é€éæ­£ç¢ºçš„è¨»è§£ã€è‰¯å¥½çš„æ¸¬è©¦ä½¿ä¹‹æœ€å°åŒ–ã€‚","link":"/2021/08/06/testablejs0202/"},{"title":"æ‰‹å‹•å»ºç«‹ Google ã€ Facebook ç¬¬ä¸‰æ–¹ç™»å…¥","text":"å‰é™£å­é‡åˆ°å®¢æˆ¶åæ‡‰ Facebookã€Google ç¬¬ä¸‰æ–¹ç™»å…¥ API åœ¨ instagram ã€ Line ç­‰å…§å»ºç€è¦½å™¨(in-app browser) ç„¡ç—•ç€è¦½æ¨¡å¼ ç„¡æ³•ä½¿ç”¨çš„å•é¡Œï¼ŒèŠ±äº†ä¸€æ®µæ™‚é–“ç³¾çµè·Ÿè§£æ±ºQQã€‚æ„å¤–å­¸äº†å¾ˆå¤šä»¥å‰ä¸çŸ¥é“çš„æ±è¥¿ï¼Œè¨˜éŒ„ä¸€ä¸‹ï¼ åŸå…ˆçš„åšæ³•åˆ©ç”¨ Facebookã€Google æä¾›çš„ API ï¼Œä½¿ç”¨èµ·ä¾†å¾ˆå–®ç´”ï¼šé–‹å•Ÿæ–°åˆ†é ï¼Œä½¿ç”¨è€…å®Œæˆç™»å…¥æµç¨‹å¾Œå›å‚³è³‡æ–™çµ¦åŸå…ˆçš„é é¢ä¸¦è‡ªå‹•é—œé–‰ã€‚ ğŸ¤¯ in-app browser çš„å•é¡Œï¼š é–‹å•Ÿæ–°åˆ†é é€™é¡ç€è¦½å™¨å¤§å¤š æ²’æœ‰åˆ†é åŠŸèƒ½ï¼Œæœƒç›´æ¥åœ¨åŒä¸€é åšåˆ‡æ›ã€‚åŸå…ˆç­‰å¾…å›å‚³çš„é‚£é å°±æ¶ˆå¤±äº†ï¼Œä¹Ÿå°±ç„¡æ³•æ”¶åˆ°å›å‚³ã€‚ ğŸ¤¯ ç„¡ç—•ç€è¦½çš„å•é¡Œï¼š cookie è¢«é˜»æ“‹Safari å’Œ Chrome çš„è¡¨ç¾ä¸å¤ªä¸€æ¨£ã€‚Safari ï¼ˆ14.0.3ï¼‰æ²’å•é¡Œï¼Œä½† Chrome æœƒæ“‹ cookie é€²è€Œå½±éŸ¿åˆ°è‡ªå®¶çš„ç™»å…¥API (å‚»çœ¼) chrome ç„¡ç—•æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨ gapi.auth2.init æ–¹æ³•æœƒå‡ºç¾çš„error messageã€‚ æ‰‹å‹•å»ºç«‹ç™»å…¥æµç¨‹ï¼šone-page-flowä¸»è¦æ˜¯åœ¨åŒä¸€é é¢åˆ©ç”¨è½‰å€çš„æ–¹å¼é€²è¡Œç™»å…¥ï¼Œä¸¦åœ¨æœ€å¾Œå°‡ç™»å…¥è³‡æ–™å¸¶åœ¨è½‰å›ç¶²å€çš„åƒæ•¸ä¸­ã€‚å¾ åŸå…ˆï¼šæŒ‰ä¸‹ç™»å…¥ â†’ é–‹å•Ÿæ–°åˆ†é  â†’ ç™»å…¥ â†’ é—œé–‰åˆ†é  â†’ åŸå…ˆç™»å…¥é æ¥æ”¶ API å›å‚³ æ”¹æˆï¼šæŒ‰ä¸‹ç™»å…¥ â†’ å‰å¾€ç™»å…¥é  â†’ ç™»å…¥ â†’ å°å›æŒ‡å®šé é¢ï¼Œè³‡æ–™å¸¶åœ¨ç¶²å€ä¸­ åªè¦è¨­å®šå¥½ ç™»å…¥é çš„ç¶²å€ å°±å·®ä¸å¤šæˆåŠŸäº†ï¼›å°å›å¾Œï¼Œä¹Ÿåªè¦åœ¨ route ä¸­å»å¢åŠ ä¸€äº›å°åƒæ•¸çš„åˆ¤æ–·ã€è™•ç†å°±å¥½äº†ã€‚ Facebookè¦ºå¾—è‡‰æ›¸å¯«çš„æ–‡ä»¶æ¯”è¼ƒå¥½æ‡‚ï¼Œå…ˆæ‹¿è‡‰æ›¸ä¾†ç•¶ç¯„ä¾‹ 123456https://www.facebook.com/v10.0/dialog/oauth? client_id={app-id} //required &amp;redirect_uri={ç™»å…¥å®Œå¾Œçš„å›å‚³å€} //required &amp;state={é˜²æ­¢è·¨ç¶²ç«™å½é€ çš„çš„å­—ä¸²ï¼Œä¹Ÿæœƒè¢«æ”¾åœ¨å›å‚³ç¶²å€ä¸­} //required &amp;response_type={å›å‚³è³‡æ–™é¡å‹} //optionalï¼Œé è¨­ç‚º code &amp;scope={ä½ è¦å‘ä½¿ç”¨è€…è¦æ±‚çš„å¸³è™Ÿæ¬Šé™} //optional Googleé™¤äº†å¯ä»¥çœ‹ JS Web Apps ï¼Œä¹Ÿå¯ä»¥ä¸€èµ·çœ‹ Mobile and Desktop Apps è£¡çš„å…§å®¹ï¼Œå¯«èµ·ä¾†è·Ÿ facebook å¹¾ä¹å®Œå…¨ä¸€æ¨£ XDï¼š 123456https://accounts.google.com/o/oauth2/v2/auth? client_id={app-id} &amp;redirect_uri=https://jyun1desu.com/login &amp;state=google &amp;response_type=code &amp;scope=email%20profile æ¯”è¼ƒéœ€è¦æ³¨æ„çš„åƒæ•¸ï¼š response_type codeï¼š è·Ÿ API ç›´æ¥å–å¾— access_token ä¸åŒï¼Œéœ€è¦èµ° server-side loginï¼šå‰ç«¯çµ¦å¾Œç«¯ code ï¼Œç”±å¾Œç«¯å»æ›å– access_tokenã€‚ tokenï¼š ç›´æ¥å–å¾— access_tokenã€‚ é›–ç„¶ç›´æ¥è¨­å®š token å¾ˆæ–¹ä¾¿ï¼Œä½†è³‡æ–™ä¸æœƒä»¥åƒæ•¸(?)ã€è€Œæ˜¯ä»¥ç¶²å€ç‰‡æ®µ(#)çš„æ–¹å¼å­˜åœ¨ã€‚è¦ºå¾—é€™æ¨£å–è³‡æ–™æœ‰é»éº»ç…©ã€ä¹Ÿæœ‰å·¥ç¨‹å¸«å»ºè­° server-side login å¾Œç«¯çš„æ¬Šé™ç®¡ç†æœƒæ¯”è¼ƒè¸å¯¦ï¼Œå°±æ±ºå®šå– code äº†ï¼ˆå¾Œç«¯äººå¾ˆå¥½ï¼‰ã€‚ redirect_uri è¦è¨˜å¾—åˆ°ç•¶åˆåœ¨ facebook developer / google cloud å»ºç«‹çš„æ‡‰ç”¨ç¨‹å¼ä¸­ï¼Œ æœ‰æ•ˆçš„ OAuth é‡æ–°å°å‘ URI æ–°å¢æœ‰æ•ˆç¶²å€ã€‚ä¸åœ¨åˆ—è¡¨ä¸­çš„ç¶²å€éƒ½æœƒè¢«æ“‹ä¸‹ä¾†(è·¯å¾‘ã€åƒæ•¸ä¹Ÿéƒ½è¦å¡«ä¸Š)ã€‚ å¯æ˜¯æˆ‘æƒ³é–‹å•Ÿæ–°é é¢ Ræ’‡é™¤åœ¨ in-app browser æ²’æœ‰åˆ†é åŠŸèƒ½å…ˆä¸ç†å®ƒXDï¼Œé€™å€‹æ–¹æ³•æœ€å¤§çš„ç¼ºé»æ˜¯é é¢éƒ½æœƒåœ¨åŒä¸€é è·³è½‰ï¼Œè·Ÿå¤šæ•¸ä½¿ç”¨è€…ç¿’æ…£çš„é«”é©—æ˜¯ä¸ä¸€æ¨£çš„ã€‚ä¸€é–‹å§‹æƒ³æ³•æ˜¯ï¼š in-app browser â†’ æ‰‹å‹•æµç¨‹(ä¸é–‹æ–°åˆ†é ) ä¸€èˆ¬ç€è¦½å™¨ æ­£å¸¸æ¨¡å¼ â†’ ä¿ç•™ä½¿ç”¨API ç„¡ç—•æ¨¡å¼ â†’ æ‰‹å‹•æµç¨‹(ä¸é–‹æ–°åˆ†é ) çµæœæ‰¾ä¸åˆ°åˆ¤æ–·ç„¡ç—•çš„å¯é æ–¹æ³•â€¦ğŸ¥² ï¼Œåªèƒ½æ”¹æˆé€™æ¨£ï¼š in-app browser â†’ æ‰‹å‹•æµç¨‹(ä¸é–‹æ–°åˆ†é ) ä¸€èˆ¬ç€è¦½å™¨ â†’ æ‰‹å‹•æµç¨‹(ä¸é–‹æ–°åˆ†é â‹¯â‹¯ä½†å¥½æƒ³é–‹Rï¼ï¼ï¼) æ–¼æ˜¯é–‹å§‹æƒ³è¦æ€éº¼æ¨¡æ“¬ API é–‹å•Ÿæ–°åˆ†é ã€å‚³è³‡æ–™çµ¦éš”å£åˆ†é ã€è‡ªå‹•é—œé–‰ çš„è¡Œç‚ºï¼š é–‹å•Ÿæ–°åˆ†é ï¼šç”¨ window.open() å³å¯ XD è‡ªå‹•é—œé–‰ï¼šé€™å€‹ä¹Ÿå¾ˆç°¡å–®ï¼Œç”¨ window.close() å³å¯ XD å‚³è³‡æ–™çµ¦éš”å£åˆ†é ï¼šé€™å€‹å¥½é›£RRRRRRRï¼ï¼ï¼ï¼ï¼ ç³¾çµå¥½å¹¾å¤©å¾Œï¼ˆé€£ localStorage æ­é… visibilitychangeEvent éƒ½è©¦äº†ğŸ¥²ï¼‰ï¼Œç™¼ç¾å¾ˆè®šçš„ window.postMessage()MDNçš„è§£é‡‹å¾ˆè©³ç´° ï¼Œä»¥å‰å±…ç„¶ä¸çŸ¥é“é€™å€‹ APIï¼Œæœ¬æ¬¡æœ€å¤§æ”¶ç©«ï½ï½ï½ postMessage å¯ä»¥å¯¦ç¾åŒå€‹ç€è¦½å™¨ä¸‹çš„æºé€šï¼štabé–“ã€å½ˆå‡ºè¦–çª—èˆ‡ä¸»è¦–çª—é–“ã€ç”šè‡³å’ŒåµŒå…¥çš„ iframe ä¹Ÿå¯ä»¥ï½å¤ªæ–¹ä¾¿å•¦ï¼ä½¿ç”¨èµ·ä¾†ä¹Ÿæ»¿ç›´è§€çš„ï¼š postMessage(message, targetOrigin, transfer) messageï¼šè¦å‚³é€çš„è³‡æ–™ï¼Œå¿…å¡«ã€‚ targetOriginï¼šé™åˆ¶æ¥æ”¶å°è±¡çš„ origin ï¼Œä½¿ç”¨å­—ä¸² * å‰‡ä»£è¡¨ç„¡é™åˆ¶ï¼Œå¿…å¡«ã€‚ transferï¼šçœ‹ç„¡â€¦.ä½†å¥½åƒä¸å¤ªç”¨åˆ°ã€‚ ç›£è½ä¾†è‡ªä»–æ–¹çš„ message ä¹Ÿå¾ˆç°¡å–®ï¼šwindow.addEventListener('message', callback) ç°¡æ˜“çš„ç¯„ä¾‹åœ¨æŒ‰ä¸‹ç¬¬ä¸‰æ–¹ç™»å…¥éˆ•çš„æ™‚å€™åˆ¤æ–·æ˜¯å¦æ˜¯ in-app browser trueï¼š ä¸é–‹å•Ÿæ–°é é¢ falseï¼š é–‹å•Ÿæ–°é é¢ã€ redirect_uri å¤šè¨­å®šä¸€å€‹åƒæ•¸ï¼Œåˆ¤æ–·å›ä¾†è¦åšä¸€äº›äº‹ é»æ“Šç¬¬ä¸‰æ–¹ç™»å…¥éˆ•è§¸ç™¼ openThirdPartyAuthPageï¼š 1234567891011121314151617181920212223242526272829303132const addReciveMessageListener = () =&gt; { const reciveEvent = e =&gt; { const data = e.data if(origin === window.location.origin &amp;&amp; data.code) { doSomethingToLogin(data.code) window.removeEventListener('message', reciveEvent, false); } }; window.addEventListener('message', reciveEvent, false);};const getOAuthPageURL = (platform, isWebview) =&gt; { const redirect = isWebview? '.../login' : '.../login?type=auto-close'; switch(platform) { case 'facebook': return `https:// .....&amp;redirect_uri=${redirectUri}....`; case 'google': return `https:// .....&amp;redirect_uri=${redirectUri}....`; }}const toThirdPartyOAuthPage = platform =&gt; { const isWebview = ...; //åšä¸€äº› in-app browser çš„åˆ¤æ–· const authPageURL = getOAuthPageURL(platform, isWebview); if(isWebview){ window.location.href = authPageURL; } else { addReciveMessageListener(); window.open(authPageURL); }} è¦–çª—å›åˆ° redirect_uri å¾Œï¼Œåœ¨ route ä¸­è™•ç†ç™»å…¥è¡Œç‚ºï¼š 123456789101112131415161718// routes/Login/index.jsconst { code, type, ... } = ç¶²å€çš„query;const sendDataToLoginPage = () =&gt; { const loginData = { code }; window.opener.postMessage(loginData, 'http://jyun1desu.com');}if(code) { if(type === 'auto-close') { // normal browser redirect page sendDataToLoginPage(); window.close(); } else{ // in-app browser redirect page doSomethingToLogin(code) }} æˆåŠŸçš„æ™‚å€™å¥½æ„Ÿå‹•å•Šï½ï½ï½ ğŸ‰ğŸ‰ğŸ‰ æ‰¾è³‡æ–™çš„éç¨‹ä¸­ä¹Ÿæœ‰çœ‹åˆ° Broadcast Channel API ï¼Œé›–ç„¶æ”¯æ´åº¦é‚„å¾ˆæ‚²åŠ‡ï¼Œæ„Ÿè¦ºæ˜¯èƒ½å…ˆçœ‹èµ·ä¾†çš„æ±è¥¿ã€‚æœ€å¾Œè¬è¬ hahow ï¼Œ ä¸€åº¦è¦ºå¾—è§£æ±ºä¸äº†çš„ç„¡å¾ˆå¤šå•é¡Œï¼Œå»çœ‹äº† hahow çš„ç¶²ç«™ä¹‹å¾Œæ‰ç™¼ç¾ï¼šå—¯ï¼æœç„¶æ˜¯è‡ªå·±å¤ªæ·ºã„Œ&gt;&lt;ï¼Œå°±æ˜¯æœ‰äººåšå¾—åˆ°å•Šï¼ï¼ï¼è€Œä¸”å¯«é€™ç¯‡æ–‡ç« çš„æ™‚å€™ï¼Œçªç„¶è¦ºå¾—æ˜¯ä¸æ˜¯å…¶å¯¦æ»¿ç°¡å–®çš„â‹¯â‹¯ï¼ˆä½†ç¬¬ä¸€æ¬¡ç¢°åˆ°å°±æ˜¯è¦ºå¾—å¾ˆé›£QQï¼‰ã€‚ ä»¥ä¸Šï¼å¸Œæœ›èƒ½å¹«åŠ©åˆ°æ­£åœ¨å›°æ“¾åŒæ¨£å•é¡Œçš„äºº ğŸ‰ åƒè€ƒè³‡æ–™Google OAuthFacebook OAuthpostMessage API","link":"/2021/07/19/third-party-login/"}],"tags":[{"name":"css","slug":"css","link":"/tags/css/"},{"name":"Recoil","slug":"Recoil","link":"/tags/Recoil/"},{"name":"React","slug":"React","link":"/tags/React/"},{"name":"web","slug":"web","link":"/tags/web/"},{"name":"rendering performance","slug":"rendering-performance","link":"/tags/rendering-performance/"},{"name":"æ•ˆèƒ½èª¿æ ¡","slug":"æ•ˆèƒ½èª¿æ ¡","link":"/tags/%E6%95%88%E8%83%BD%E8%AA%BF%E6%A0%A1/"},{"name":"styled-components","slug":"styled-components","link":"/tags/styled-components/"},{"name":"ES6","slug":"ES6","link":"/tags/ES6/"},{"name":"Tagged template","slug":"Tagged-template","link":"/tags/Tagged-template/"},{"name":"å¯æ¸¬è©¦çš„ JavaScript","slug":"å¯æ¸¬è©¦çš„-JavaScript","link":"/tags/%E5%8F%AF%E6%B8%AC%E8%A9%A6%E7%9A%84-JavaScript/"},{"name":"è®€æ›¸ç­†è¨˜","slug":"è®€æ›¸ç­†è¨˜","link":"/tags/%E8%AE%80%E6%9B%B8%E7%AD%86%E8%A8%98/"},{"name":"è¤‡é›œåº¦","slug":"è¤‡é›œåº¦","link":"/tags/%E8%A4%87%E9%9B%9C%E5%BA%A6/"},{"name":"ç›¸ä¾æ€§æ³¨å…¥","slug":"ç›¸ä¾æ€§æ³¨å…¥","link":"/tags/%E7%9B%B8%E4%BE%9D%E6%80%A7%E6%B3%A8%E5%85%A5/"},{"name":"è€¦åˆ","slug":"è€¦åˆ","link":"/tags/%E8%80%A6%E5%90%88/"},{"name":"ç¬¬ä¸‰æ–¹ç™»å…¥","slug":"ç¬¬ä¸‰æ–¹ç™»å…¥","link":"/tags/%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%85%A5/"},{"name":"googleç™»å…¥","slug":"googleç™»å…¥","link":"/tags/google%E7%99%BB%E5%85%A5/"},{"name":"facebookç™»å…¥","slug":"facebookç™»å…¥","link":"/tags/facebook%E7%99%BB%E5%85%A5/"}],"categories":[{"name":"CSS","slug":"CSS","link":"/categories/CSS/"},{"name":"JavaScript","slug":"JavaScript","link":"/categories/JavaScript/"},{"name":"Web","slug":"Web","link":"/categories/Web/"},{"name":"ã€Šå¯æ¸¬è©¦çš„ JavaScriptã€‹ è®€æ›¸ç­†è¨˜","slug":"ã€Šå¯æ¸¬è©¦çš„-JavaScriptã€‹-è®€æ›¸ç­†è¨˜","link":"/categories/%E3%80%8A%E5%8F%AF%E6%B8%AC%E8%A9%A6%E7%9A%84-JavaScript%E3%80%8B-%E8%AE%80%E6%9B%B8%E7%AD%86%E8%A8%98/"}]}